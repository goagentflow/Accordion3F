{"ast":null,"code":"var _jsxFileName = \"/Users/hamishnicklin/Accordion3F/src/TimelineBuilder.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport Papa from 'papaparse';\nimport AssetSelector from './components/AssetSelector';\nimport CampaignSetup from './components/CampaignSetup';\nimport GanttChart from './components/GanttChart';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TimelineBuilder = () => {\n  _s();\n  // CSV and asset data\n  const [csvData, setCsvData] = useState([]);\n  const [uniqueAssets, setUniqueAssets] = useState([]);\n  // Each selected asset is now an object with a unique id, type, name, and startDate\n  const [selectedAssets, setSelectedAssets] = useState([]);\n\n  // Live date management\n  const [globalLiveDate, setGlobalLiveDate] = useState('');\n  const [useGlobalDate, setUseGlobalDate] = useState(true);\n  const [assetLiveDates, setAssetLiveDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n\n  // Calculated results\n  const [calculatedStartDates, setCalculatedStartDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n  const [projectStartDate, setProjectStartDate] = useState(''); // Earliest start date across all assets\n  const [dateErrors, setDateErrors] = useState([]); // Array of asset names that start before today\n\n  // Final timeline for display\n  const [timelineTasks, setTimelineTasks] = useState([]);\n  const [showInfoBox, setShowInfoBox] = useState(true); // Add state for info box\n\n  // Add state to store custom task durations for each asset instance\n  const [assetTaskDurations, setAssetTaskDurations] = useState({}); // { assetId: { taskName: duration, ... } }\n\n  // Add state to store custom tasks separately\n  const [customTasks, setCustomTasks] = useState([]); // Array of custom task objects\n\n  // Add state to store custom task names\n  const [customTaskNames, setCustomTaskNames] = useState({}); // { taskId: customName }\n\n  // Add state to store bank holidays\n  const [bankHolidays, setBankHolidays] = useState([]); // Array of YYYY-MM-DD strings\n\n  // State for undo/redo functionality\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [isUndoRedoAction, setIsUndoRedoAction] = useState(false);\n\n  // Helper function to get task name (custom or default)\n  const getTaskName = (taskId, assetName, taskInfo) => {\n    // Check if there's a custom name for this task\n    if (customTaskNames[taskId]) {\n      return customTaskNames[taskId];\n    }\n    // Return default format\n    return `${assetName}: ${taskInfo['Task']}`;\n  };\n\n  // Create a snapshot of the current app state for undo/redo\n  const createStateSnapshot = actionDescription => {\n    const snapshot = {\n      // Asset state\n      selectedAssets: JSON.parse(JSON.stringify(selectedAssets)),\n      assetLiveDates: JSON.parse(JSON.stringify(assetLiveDates)),\n      useGlobalDate,\n      globalLiveDate,\n      // Task state\n      customTaskNames: JSON.parse(JSON.stringify(customTaskNames)),\n      assetTaskDurations: JSON.parse(JSON.stringify(assetTaskDurations)),\n      customTasks: JSON.parse(JSON.stringify(customTasks)),\n      // UI state\n      showInfoBox,\n      // Calculated state (will be recalculated after restoration)\n      timelineTasks: JSON.parse(JSON.stringify(timelineTasks)),\n      calculatedStartDates: JSON.parse(JSON.stringify(calculatedStartDates)),\n      dateErrors: JSON.parse(JSON.stringify(dateErrors)),\n      projectStartDate,\n      // Metadata\n      timestamp: Date.now(),\n      actionDescription,\n      actionType: 'user_action'\n    };\n    console.log('Creating snapshot with action:', actionDescription);\n    console.log('Snapshot customTasks length:', snapshot.customTasks.length);\n    console.log('Snapshot customTasks:', snapshot.customTasks);\n    return snapshot;\n  };\n\n  // Restore app state from a snapshot\n  const restoreFromSnapshot = snapshot => {\n    console.log('restoreFromSnapshot called with:', snapshot);\n\n    // Validate snapshot before restoring\n    if (!snapshot || typeof snapshot !== 'object') {\n      console.error('Invalid snapshot provided to restoreFromSnapshot');\n      return;\n    }\n    console.log('Restoring state from snapshot...');\n\n    // Restore only the input state (what the user controls)\n    if (snapshot.selectedAssets) {\n      console.log('Restoring selectedAssets:', snapshot.selectedAssets);\n      setSelectedAssets(snapshot.selectedAssets);\n    }\n    if (snapshot.assetLiveDates) {\n      console.log('Restoring assetLiveDates:', snapshot.assetLiveDates);\n      setAssetLiveDates(snapshot.assetLiveDates);\n    }\n    if (snapshot.useGlobalDate !== undefined) {\n      console.log('Restoring useGlobalDate:', snapshot.useGlobalDate);\n      setUseGlobalDate(snapshot.useGlobalDate);\n    }\n    if (snapshot.globalLiveDate) {\n      console.log('Restoring globalLiveDate:', snapshot.globalLiveDate);\n      setGlobalLiveDate(snapshot.globalLiveDate);\n    }\n    if (snapshot.customTaskNames) {\n      console.log('Restoring customTaskNames:', snapshot.customTaskNames);\n      setCustomTaskNames(snapshot.customTaskNames);\n    }\n    if (snapshot.assetTaskDurations) {\n      console.log('Restoring assetTaskDurations:', snapshot.assetTaskDurations);\n      setAssetTaskDurations(snapshot.assetTaskDurations);\n    }\n    if (snapshot.customTasks) {\n      console.log('Restoring customTasks:', snapshot.customTasks);\n      setCustomTasks(snapshot.customTasks);\n    }\n    if (snapshot.showInfoBox !== undefined) {\n      console.log('Restoring showInfoBox:', snapshot.showInfoBox);\n      setShowInfoBox(snapshot.showInfoBox);\n    }\n    console.log('State restoration complete');\n\n    // Don't restore calculated state - let the useEffect recalculate it fresh\n    // This prevents conflicts between old calculated state and new input state\n    // setTimelineTasks(snapshot.timelineTasks);\n    // setCalculatedStartDates(snapshot.calculatedStartDates);\n    // setDateErrors(snapshot.dateErrors);\n    // setProjectStartDate(snapshot.projectStartDate);\n  };\n\n  // Undo function\n  const undo = () => {\n    console.log('undo called');\n    console.log('Current history length:', history.length, 'historyIndex:', historyIndex);\n    console.log('History array:', history);\n    if (historyIndex > 0 && history.length > 0) {\n      console.log('Attempting undo to index:', historyIndex - 1);\n\n      // Ensure historyIndex doesn't exceed history length\n      const validIndex = Math.min(historyIndex - 1, history.length - 1);\n      console.log('Using valid index:', validIndex);\n      const previousSnapshot = history[validIndex];\n      console.log('Previous snapshot:', previousSnapshot);\n      if (previousSnapshot && previousSnapshot.selectedAssets) {\n        console.log('Restoring from snapshot');\n        setIsUndoRedoAction(true);\n        restoreFromSnapshot(previousSnapshot);\n        setHistoryIndex(validIndex);\n        setIsUndoRedoAction(false);\n      } else {\n        console.error('Invalid snapshot found in history during undo');\n      }\n    } else {\n      console.log('Cannot undo: historyIndex <= 0 or no previous snapshot');\n      console.log('historyIndex:', historyIndex);\n      console.log('history.length:', history.length);\n    }\n  };\n\n  // Redo function\n  const redo = () => {\n    if (historyIndex < history.length - 1 && history[historyIndex + 1]) {\n      setIsUndoRedoAction(true);\n      const nextSnapshot = history[historyIndex + 1];\n      if (nextSnapshot && nextSnapshot.selectedAssets) {\n        restoreFromSnapshot(nextSnapshot);\n        setHistoryIndex(prev => prev + 1);\n      } else {\n        console.error('Invalid snapshot found in history during redo');\n        // Remove the invalid snapshot and try again\n        setHistory(prev => prev.filter(snapshot => snapshot && snapshot.selectedAssets));\n        setHistoryIndex(prev => Math.min(prev, history.length - 1));\n      }\n      setIsUndoRedoAction(false);\n    }\n  };\n\n  // Execute an action and save it to history\n  const executeAction = (action, description) => {\n    console.log('executeAction called with:', description);\n    console.log('Current history length:', history.length, 'historyIndex:', historyIndex);\n\n    // Execute the action\n    action();\n\n    // Create a snapshot of current state AFTER executing the action\n    const currentSnapshot = createStateSnapshot(description);\n    console.log('Created snapshot:', currentSnapshot);\n\n    // Add to history (but not during undo/redo operations)\n    if (!isUndoRedoAction) {\n      console.log('Adding to history (not undo/redo action)');\n      setHistory(prev => {\n        const newHistory = [...prev.slice(0, historyIndex + 1), currentSnapshot];\n        console.log('New history length:', newHistory.length);\n        console.log('New history array:', newHistory);\n        return newHistory;\n      });\n      setHistoryIndex(prev => {\n        const newIndex = prev + 1;\n        console.log('New history index:', newIndex);\n        return newIndex;\n      });\n    } else {\n      console.log('Skipping history update (undo/redo action)');\n    }\n  };\n\n  // Helper function to check if date is a non-working day (weekend or bank holiday)\n  const isNonWorkingDay = date => {\n    const day = date.getDay();\n    const yyyy_mm_dd = date.toISOString().split('T')[0];\n    return day === 0 || day === 6 || bankHolidays.includes(yyyy_mm_dd);\n  };\n\n  // Helper function to get previous working day\n  const getPreviousWorkingDay = date => {\n    let workingDate = new Date(date);\n    do {\n      workingDate.setDate(workingDate.getDate() - 1);\n    } while (isNonWorkingDay(workingDate));\n    return workingDate;\n  };\n\n  // Helper function to get next working day\n  const getNextWorkingDay = date => {\n    let workingDate = new Date(date);\n    do {\n      workingDate.setDate(workingDate.getDate() + 1);\n    } while (isNonWorkingDay(workingDate));\n    return workingDate;\n  };\n\n  // Helper function to subtract working days (backwards calculation)\n  const subtractWorkingDays = (endDate, workingDaysToSubtract) => {\n    let currentDate = new Date(endDate);\n    let remainingDays = workingDaysToSubtract;\n    // Subtract working days\n    while (remainingDays > 0) {\n      currentDate.setDate(currentDate.getDate() - 1);\n      // Only count non-non-working days\n      if (!isNonWorkingDay(currentDate)) {\n        remainingDays--;\n      }\n    }\n    return currentDate;\n  };\n\n  // Helper function to add working days (forward calculation for display)\n  const addWorkingDays = (startDate, workingDaysToAdd) => {\n    if (workingDaysToAdd <= 0) {\n      return new Date(startDate);\n    }\n    let currentDate = new Date(startDate);\n    let remainingDays = workingDaysToAdd - 1;\n    while (remainingDays > 0) {\n      currentDate.setDate(currentDate.getDate() + 1);\n      if (!isNonWorkingDay(currentDate)) {\n        remainingDays--;\n      }\n    }\n    // Ensure the final day is a working day\n    while (isNonWorkingDay(currentDate)) {\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n    return currentDate;\n  };\n\n  // Load CSV data\n  useEffect(() => {\n    Papa.parse(`${window.location.origin}/Group_Asset_Task_Time.csv`, {\n      download: true,\n      header: true,\n      skipEmptyLines: true,\n      complete: results => {\n        const parsedData = results.data;\n        setCsvData(parsedData);\n\n        // Extract unique asset types from CSV\n        const assetTypes = [...new Set(parsedData.map(row => row['Asset Type']))].filter(type => type);\n        setUniqueAssets(assetTypes);\n      },\n      error: error => {\n        console.error(\"Error parsing CSV file:\", error);\n      }\n    });\n  }, []);\n\n  // Fetch UK bank holidays for England and Wales on app load\n  useEffect(() => {\n    fetch('https://www.gov.uk/bank-holidays.json').then(response => response.json()).then(data => {\n      // Get all dates for England and Wales\n      const events = data['england-and-wales'].events;\n      // Get all dates for the next 10 years\n      const now = new Date();\n      const tenYearsFromNow = new Date(now.getFullYear() + 10, now.getMonth(), now.getDate());\n      const holidayDates = events.map(event => event.date).filter(dateStr => {\n        const date = new Date(dateStr);\n        return date >= now && date <= tenYearsFromNow;\n      });\n      setBankHolidays(holidayDates);\n    }).catch(err => {\n      // If fetch fails, fallback to an empty array (or you could use a static list)\n      setBankHolidays([]);\n    });\n  }, []);\n\n  // Calculate backwards timeline when live dates or assets change\n  useEffect(() => {\n    if (selectedAssets.length === 0 || csvData.length === 0) {\n      setTimelineTasks([]);\n      setCalculatedStartDates({});\n      setProjectStartDate('');\n      setDateErrors([]);\n      return;\n    }\n    const today = new Date();\n    today.setHours(0, 0, 0, 0); // Reset time for accurate comparison\n\n    const newCalculatedStartDates = {};\n    const newDateErrors = [];\n    const allStartDates = [];\n    const allTasks = [];\n\n    // Loop over each selected asset instance (not just type)\n    selectedAssets.forEach(asset => {\n      // asset: { id, type, name, startDate }\n      if (!asset.startDate) return; // Skip if no start date set\n\n      // Find all tasks for this asset type from the CSV\n      const assetTasks = csvData.filter(row => row['Asset Type'] === asset.type);\n      if (assetTasks.length === 0) return;\n\n      // Use the asset instance's startDate as the go-live date\n      const liveDate = new Date(asset.startDate);\n      if (isNaN(liveDate.getTime())) return;\n\n      // We'll build the tasks in reverse (from go-live backwards)\n      let currentEndDate = new Date(liveDate);\n      const ganttTasks = [];\n      let taskIndex = 0;\n\n      // Go-live task (single day)\n      const goLiveTaskId = `${asset.id}-go-live`;\n      ganttTasks.unshift({\n        id: goLiveTaskId,\n        name: getTaskName(goLiveTaskId, asset.name, {\n          'Task': 'Go-Live'\n        }),\n        start: liveDate.toISOString().split('T')[0],\n        end: liveDate.toISOString().split('T')[0],\n        progress: 0\n      });\n      taskIndex++;\n\n      // Process all other tasks in reverse order\n      for (let i = assetTasks.length - 1; i >= 0; i--) {\n        const taskInfo = assetTasks[i];\n        // Use custom duration if present, else default from CSV\n        // Use asset.type as the key to match CSV task names consistently\n        const customDurations = assetTaskDurations[asset.type] || {};\n        const duration = customDurations[taskInfo['Task']] !== undefined ? customDurations[taskInfo['Task']] : parseInt(taskInfo['Duration (Days)'], 10) || 1;\n        // Subtract working days to get the start date\n        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n        // Task ends the working day before currentEndDate\n        const taskEndDate = new Date(currentEndDate);\n        taskEndDate.setDate(taskEndDate.getDate() - 1);\n        // Ensure end date is a working day\n        let finalTaskEndDate = new Date(taskEndDate);\n        if (isNonWorkingDay(finalTaskEndDate)) {\n          finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n        }\n        const taskId = `${asset.id}-task-${taskIndex}`;\n        ganttTasks.unshift({\n          id: taskId,\n          name: getTaskName(taskId, asset.name, taskInfo),\n          start: taskStartDate.toISOString().split('T')[0],\n          end: finalTaskEndDate.toISOString().split('T')[0],\n          progress: 0\n        });\n        taskIndex++;\n        // Update currentEndDate for the next task\n        currentEndDate = new Date(taskStartDate);\n      }\n\n      // Add all tasks for this asset instance to the main list\n      allTasks.push(...ganttTasks);\n\n      // Set the calculated start date for this asset to the start date of the first (earliest) task\n      if (ganttTasks.length > 0 && ganttTasks[0].start) {\n        newCalculatedStartDates[asset.id] = ganttTasks[0].start;\n        allStartDates.push(new Date(ganttTasks[0].start));\n      }\n\n      // Check if start date is before today\n      if (ganttTasks.length > 0 && new Date(ganttTasks[0].start) < today) {\n        newDateErrors.push(asset.id);\n      }\n    });\n\n    // Find earliest start date across all assets\n    if (allStartDates.length > 0) {\n      const earliestDate = new Date(Math.min(...allStartDates));\n      setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n    }\n\n    // Handle custom tasks by integrating them into the timeline\n    if (customTasks.length > 0) {\n      console.log('Processing custom tasks:', customTasks);\n\n      // First, create a simple timeline with all asset tasks\n      const assetTimeline = [...allTasks];\n      console.log('Initial asset timeline:', assetTimeline);\n\n      // Insert custom tasks at their specified positions\n      customTasks.forEach(customTask => {\n        let insertIndex = 0;\n        if (customTask.insertAfterTaskId) {\n          const afterTaskIndex = assetTimeline.findIndex(task => task.id === customTask.insertAfterTaskId);\n          console.log('Looking for insertAfterTaskId:', customTask.insertAfterTaskId, 'found at index:', afterTaskIndex);\n          if (afterTaskIndex !== -1) {\n            insertIndex = afterTaskIndex + 1;\n          }\n        }\n        console.log('Inserting custom task at index:', insertIndex);\n\n        // Insert the custom task (without dates for now)\n        assetTimeline.splice(insertIndex, 0, {\n          ...customTask,\n          start: '',\n          // Will be calculated below\n          end: '' // Will be calculated below\n        });\n      });\n      console.log('Timeline after inserting custom tasks:', assetTimeline);\n\n      // Now rebuild the timeline backwards from go-live to maintain constraints\n      const finalTimeline = [];\n\n      // Group tasks by asset to maintain the backwards calculation\n      const tasksByAsset = {};\n      assetTimeline.forEach(task => {\n        if (task.isCustom) {\n          // Custom tasks need to be associated with the asset they belong to\n          // Find which asset this custom task belongs to based on insertAfterTaskId\n          let targetAssetId = null;\n          if (task.insertAfterTaskId) {\n            const afterTask = assetTimeline.find(t => t.id === task.insertAfterTaskId);\n            if (afterTask) {\n              targetAssetId = afterTask.id.split('-')[0];\n            }\n          }\n          if (targetAssetId) {\n            if (!tasksByAsset[targetAssetId]) tasksByAsset[targetAssetId] = [];\n            tasksByAsset[targetAssetId].push(task);\n          } else {\n            var _selectedAssets$;\n            // Fallback: associate with the first asset\n            const firstAssetId = (_selectedAssets$ = selectedAssets[0]) === null || _selectedAssets$ === void 0 ? void 0 : _selectedAssets$.id;\n            if (firstAssetId) {\n              if (!tasksByAsset[firstAssetId]) tasksByAsset[firstAssetId] = [];\n              tasksByAsset[firstAssetId].push(task);\n            }\n          }\n        } else {\n          // Asset tasks are grouped by their asset ID\n          const assetId = task.id.split('-')[0];\n          if (!tasksByAsset[assetId]) tasksByAsset[assetId] = [];\n          tasksByAsset[assetId].push(task);\n        }\n      });\n      console.log('Tasks grouped by asset:', tasksByAsset);\n\n      // Rebuild each asset's timeline backwards from go-live\n      selectedAssets.forEach(asset => {\n        const assetTasks = tasksByAsset[asset.id] || [];\n        if (assetTasks.length === 0) return;\n        console.log(`Processing asset ${asset.id} with tasks:`, assetTasks);\n\n        // Separate go-live task from other tasks\n        const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n        const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n\n        // Build backwards from go-live to calculate dates\n        let currentEndDate = new Date(asset.startDate);\n        const calculatedTasks = [];\n\n        // Calculate dates for regular tasks in reverse order (backwards from go-live)\n        for (let i = regularTasks.length - 1; i >= 0; i--) {\n          const task = regularTasks[i];\n          if (task.isCustom) {\n            // Custom task - calculate backwards from current end date\n            const taskStartDate = subtractWorkingDays(currentEndDate, task.duration);\n            const taskEndDate = new Date(currentEndDate);\n            taskEndDate.setDate(taskEndDate.getDate() - 1);\n\n            // Ensure end date is a working day\n            let finalTaskEndDate = new Date(taskEndDate);\n            if (isNonWorkingDay(finalTaskEndDate)) {\n              finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n            }\n            calculatedTasks.unshift({\n              ...task,\n              start: taskStartDate.toISOString().split('T')[0],\n              end: finalTaskEndDate.toISOString().split('T')[0]\n            });\n            currentEndDate = new Date(taskStartDate);\n          } else {\n            // Regular asset task\n            const taskInfo = csvData.find(row => row['Asset Type'] === asset.type && row['Task'] === task.name.split(': ')[1]);\n\n            // Use manual duration override if available\n            const customDurations = assetTaskDurations[asset.type] || {};\n            const duration = customDurations[taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Task']] !== undefined ? customDurations[taskInfo['Task']] : parseInt(taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Duration (Days)'], 10) || 1;\n            const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n            const taskEndDate = new Date(currentEndDate);\n            taskEndDate.setDate(taskEndDate.getDate() - 1);\n\n            // Ensure end date is a working day\n            let finalTaskEndDate = new Date(taskEndDate);\n            if (isNonWorkingDay(finalTaskEndDate)) {\n              finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n            }\n            calculatedTasks.unshift({\n              ...task,\n              start: taskStartDate.toISOString().split('T')[0],\n              end: finalTaskEndDate.toISOString().split('T')[0]\n            });\n            currentEndDate = new Date(taskStartDate);\n          }\n        }\n\n        // Add go-live task at the end\n        if (goLiveTask) {\n          calculatedTasks.push({\n            ...goLiveTask,\n            start: asset.startDate,\n            end: asset.startDate\n          });\n        }\n\n        // Add all tasks to final timeline in correct order\n        finalTimeline.push(...calculatedTasks);\n      });\n      console.log('Final timeline with custom tasks:', finalTimeline);\n      setTimelineTasks(finalTimeline);\n\n      // Update calculated start dates and date errors\n      const finalDateErrors = [];\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      selectedAssets.forEach(asset => {\n        // Get all tasks for this asset (including custom tasks)\n        const assetTasks = finalTimeline.filter(task => {\n          // Regular asset tasks\n          if (task.id.startsWith(`${asset.id}-`) && !task.name.includes('Go-Live')) {\n            return true;\n          }\n          // Custom tasks that belong to this asset\n          if (task.isCustom && task.insertAfterTaskId) {\n            const afterTask = finalTimeline.find(t => t.id === task.insertAfterTaskId);\n            if (afterTask && afterTask.id.startsWith(`${asset.id}-`)) {\n              return true;\n            }\n          }\n          return false;\n        });\n        if (assetTasks.length > 0) {\n          // Find the earliest task for this asset\n          const earliestTask = assetTasks.reduce((earliest, task) => {\n            return new Date(task.start) < new Date(earliest.start) ? task : earliest;\n          });\n\n          // Update calculated start date\n          newCalculatedStartDates[asset.id] = earliestTask.start;\n\n          // Check if start date is before today\n          if (new Date(earliestTask.start) < today) {\n            finalDateErrors.push(asset.id);\n          }\n        }\n      });\n      setCalculatedStartDates(newCalculatedStartDates);\n      setDateErrors(finalDateErrors);\n\n      // Update the global project start date to reflect the new earliest start date\n      const allFinalStartDates = Object.values(newCalculatedStartDates).map(date => new Date(date));\n      if (allFinalStartDates.length > 0) {\n        const earliestDate = new Date(Math.min(...allFinalStartDates));\n        setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n      }\n    } else {\n      setTimelineTasks(allTasks);\n      setCalculatedStartDates(newCalculatedStartDates);\n      setDateErrors(newDateErrors);\n    }\n  }, [selectedAssets, globalLiveDate, useGlobalDate, assetLiveDates, csvData, assetTaskDurations, customTaskNames, customTasks]);\n\n  // Keyboard shortcuts for undo/redo\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        undo();\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y' || (e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z') {\n        e.preventDefault();\n        redo();\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [historyIndex, history.length]);\n  // This new useEffect pre-populates individual dates when switching from global mode\n  useEffect(() => {\n    if (!useGlobalDate && globalLiveDate && selectedAssets.length > 0) {\n      const newLiveDates = {\n        ...assetLiveDates\n      };\n      let updated = false;\n      selectedAssets.forEach(asset => {\n        // Pre-fill only if the asset doesn't have an individual date set\n        if (!newLiveDates[asset.name]) {\n          // Changed to asset.name\n          newLiveDates[asset.name] = globalLiveDate; // Changed to asset.name\n          updated = true;\n        }\n      });\n      if (updated) {\n        setAssetLiveDates(newLiveDates);\n      }\n    }\n  }, [useGlobalDate, globalLiveDate, selectedAssets, assetLiveDates]);\n\n  // Sync all asset instance startDates to globalLiveDate if useGlobalDate is true\n  useEffect(() => {\n    if (useGlobalDate && globalLiveDate && !isUndoRedoAction) {\n      setSelectedAssets(prev => prev.map(asset => asset.startDate !== globalLiveDate ? {\n        ...asset,\n        startDate: globalLiveDate\n      } : asset));\n    }\n    // Optionally, if unchecked, you could clear the dates or leave as-is\n  }, [useGlobalDate, globalLiveDate, isUndoRedoAction]);\n\n  // Custom tasks are handled directly in the main timeline calculation useEffect\n  // No need for a separate preserve useEffect that creates circular dependencies\n\n  // Keep historyIndex in sync with history length\n  useEffect(() => {\n    if (historyIndex >= history.length && history.length > 0) {\n      console.log('Fixing out-of-sync historyIndex:', historyIndex, '->', history.length - 1);\n      setHistoryIndex(history.length - 1);\n    }\n  }, [history, historyIndex]);\n\n  // Handle pending actions and create snapshots after state updates\n  useEffect(() => {\n    // This useEffect is no longer needed as pendingAction state is removed.\n    // The history state will now directly reflect the state after each action.\n  }, [customTasks, selectedAssets, assetLiveDates, useGlobalDate, globalLiveDate, customTaskNames, assetTaskDurations, showInfoBox, historyIndex, isUndoRedoAction]);\n\n  // REMOVED: Separate custom task merging useEffect\n  // Custom tasks are now integrated directly into the main timeline calculation\n\n  // REMOVED: Custom task merging useEffect that was causing timeline disruption\n  // Custom tasks are now handled properly in the main timeline calculation\n  // Generate timeline tasks for Gantt chart\n  const generateTimelineTasks = startDates => {\n    if (selectedAssets.length === 0 || Object.keys(startDates).length === 0) {\n      setTimelineTasks([]);\n      return;\n    }\n    const allTasks = [];\n    let taskIndex = 0;\n    selectedAssets.forEach(asset => {\n      const assetName = asset.name; // Assuming asset object has a 'name' property\n      const assetTasks = csvData.filter(row => row['Asset Type'] === assetName);\n      if (assetTasks.length === 0) return;\n\n      // Get the correct live date for this asset\n      const liveDate = new Date(useGlobalDate ? globalLiveDate : assetLiveDates[assetName]);\n      if (isNaN(liveDate.getTime())) return;\n\n      // We'll build the tasks in reverse (from go-live backwards)\n      let currentEndDate = new Date(liveDate);\n      const ganttTasks = [];\n      let taskIndex = 0;\n\n      // Go-live task (single day)\n      ganttTasks.unshift({\n        id: `task-${taskIndex}`,\n        name: `${assetName}: Go-Live`,\n        start: liveDate.toISOString().split('T')[0],\n        end: liveDate.toISOString().split('T')[0],\n        progress: 0\n      });\n      taskIndex++;\n\n      // Process all other tasks in reverse order\n      for (let i = assetTasks.length - 1; i >= 0; i--) {\n        const taskInfo = assetTasks[i];\n        const duration = parseInt(taskInfo['Duration (Days)'], 10) || 1;\n        // Subtract working days to get the start date\n        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n        // Task ends the working day before currentEndDate\n        const taskEndDate = new Date(currentEndDate);\n        taskEndDate.setDate(taskEndDate.getDate() - 1);\n        // Ensure end date is a working day\n        let finalTaskEndDate = new Date(taskEndDate);\n        if (isNonWorkingDay(finalTaskEndDate)) {\n          finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n        }\n        ganttTasks.unshift({\n          id: `task-${taskIndex}`,\n          name: `${taskInfo['Asset Type']}: ${taskInfo['Task']}`,\n          start: taskStartDate.toISOString().split('T')[0],\n          end: finalTaskEndDate.toISOString().split('T')[0],\n          progress: 0\n        });\n        taskIndex++;\n        // Update currentEndDate for the next task\n        currentEndDate = new Date(taskStartDate);\n      }\n\n      // Add all tasks for this asset to the main list\n      allTasks.push(...ganttTasks);\n\n      // Set the calculated start date for this asset to the start date of the first (earliest) task\n      if (ganttTasks.length > 0 && ganttTasks[0].start) {\n        newCalculatedStartDates[assetName] = ganttTasks[0].start;\n      }\n    });\n\n    // Merge custom tasks back into the timeline\n    if (customTasks.length > 0) {\n      // Insert custom tasks at their specified positions\n      customTasks.forEach(customTask => {\n        let insertIndex = 0;\n        if (customTask.insertAfterTaskId) {\n          const afterTaskIndex = allTasks.findIndex(task => task.id === customTask.insertAfterTaskId);\n          if (afterTaskIndex !== -1) {\n            insertIndex = afterTaskIndex + 1;\n          }\n        }\n\n        // Create a new custom task with updated dates\n        const newCustomTask = {\n          ...customTask,\n          id: customTask.id,\n          // Keep the same ID\n          name: customTask.name,\n          duration: customTask.duration,\n          isCustom: true\n        };\n\n        // Insert the custom task\n        allTasks.splice(insertIndex, 0, newCustomTask);\n      });\n\n      // Recalculate all task dates to accommodate custom tasks\n      // This is a simplified version - in practice, you'd want to recalculate dates\n      // based on the new timeline structure\n    }\n    setCalculatedStartDates(newCalculatedStartDates);\n    setTimelineTasks(allTasks);\n  };\n\n  // Helper to generate a unique id (could use a counter or Date.now())\n  const generateAssetId = () => Date.now() + Math.random();\n\n  // Add a new asset instance\n  const handleAddAsset = assetType => {\n    executeAction(() => {\n      const newAsset = {\n        id: generateAssetId(),\n        type: assetType,\n        name: assetType,\n        // default name, can be edited later\n        startDate: useGlobalDate && globalLiveDate ? globalLiveDate : ''\n      };\n      setSelectedAssets(prev => [...prev, newAsset]);\n    }, `Add ${assetType} asset`);\n  };\n\n  // Remove an asset instance by id\n  const handleRemoveAsset = assetId => {\n    const assetToRemove = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.filter(asset => asset.id !== assetId));\n    }, `Remove ${(assetToRemove === null || assetToRemove === void 0 ? void 0 : assetToRemove.name) || 'asset'}`);\n  };\n\n  // Handler to rename an asset instance by id\n  const handleRenameAsset = (assetId, newName) => {\n    const assetToRename = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.map(asset => asset.id === assetId ? {\n        ...asset,\n        name: newName\n      } : asset));\n    }, `Rename asset to \"${newName}\"`);\n  };\n\n  // Handler to rename a task\n  const handleRenameTask = (taskId, newName) => {\n    const currentTask = timelineTasks.find(task => task.id === taskId);\n    executeAction(() => {\n      setCustomTaskNames(prev => ({\n        ...prev,\n        [taskId]: newName\n      }));\n    }, `Rename task to \"${newName}\"`);\n  };\n  const handleAssetLiveDateChange = (assetName, date) => {\n    executeAction(() => {\n      setAssetLiveDates(prev => ({\n        ...prev,\n        [assetName]: date\n      }));\n    }, `Change ${assetName} go-live date to ${date}`);\n  };\n  const handleAssetStartDateChange = (assetId, newDate) => {\n    const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.map(asset => asset.id === assetId ? {\n        ...asset,\n        startDate: newDate\n      } : asset));\n    }, `Change ${(assetToUpdate === null || assetToUpdate === void 0 ? void 0 : assetToUpdate.name) || 'asset'} go-live date to ${newDate}`);\n  };\n\n  // Handler to save custom task durations for an asset\n  const handleSaveTaskDurations = (assetId, durations) => {\n    const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setAssetTaskDurations(prev => ({\n        ...prev,\n        [assetId]: durations\n      }));\n\n      // Preserve custom tasks before timeline recalculation\n      const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n      setCustomTasks(currentCustomTasks);\n    }, `Update task durations for ${(assetToUpdate === null || assetToUpdate === void 0 ? void 0 : assetToUpdate.name) || 'asset'}`);\n  };\n\n  // Handler for drag-to-resize task duration\n  const handleTaskDurationChange = (taskId, newDuration, newEndDate) => {\n    // Find the task being modified\n    const taskIndex = timelineTasks.findIndex(task => task.id === taskId);\n    if (taskIndex === -1) return;\n    const task = timelineTasks[taskIndex];\n    const taskName = task.name.split(': ')[1]; // Get task name after the colon\n    const assetName = task.name.split(': ')[0]; // Get asset name before the colon\n\n    // Find the asset by name\n    const asset = selectedAssets.find(a => a.name === assetName);\n    if (!asset) return;\n    executeAction(() => {\n      // Update the assetTaskDurations state to trigger the same recalculation logic\n      // that the manual duration editing uses\n      // Use asset.type as the key to match CSV task names consistently\n      setAssetTaskDurations(prev => {\n        const currentDurations = prev[asset.type] || {};\n        return {\n          ...prev,\n          [asset.type]: {\n            ...currentDurations,\n            [taskName]: newDuration\n          }\n        };\n      });\n    }, `Change ${taskName} duration to ${newDuration} days`);\n  };\n\n  // Handler for adding custom tasks\n  const handleAddCustomTask = customTaskData => {\n    const {\n      name,\n      duration,\n      insertAfterTaskId\n    } = customTaskData;\n    console.log('handleAddCustomTask called with:', customTaskData);\n    executeAction(() => {\n      // Create the new custom task\n      const newTaskId = `custom-task-${Date.now()}`;\n      const newTask = {\n        id: newTaskId,\n        name: `Custom: ${name}`,\n        duration: duration,\n        insertAfterTaskId: insertAfterTaskId,\n        isCustom: true,\n        progress: 0\n      };\n      console.log('Created new custom task:', newTask);\n\n      // Add to custom tasks - this will trigger the main timeline calculation useEffect\n      setCustomTasks(prev => {\n        const updated = [...prev, newTask];\n        console.log('Updated customTasks:', updated);\n        return updated;\n      });\n\n      // Don't manually insert into timelineTasks here - let the main useEffect handle it\n      // This ensures proper timeline recalculation and date adjustments\n    }, `Add custom task \"${name}\"`);\n  };\n\n  // Helper function to count working days between two dates (exclusive)\n  const countWorkingDays = (startDate, endDate) => {\n    let count = 0;\n    const current = new Date(startDate);\n    const end = new Date(endDate);\n\n    // Move to next day to make it exclusive\n    current.setDate(current.getDate() + 1);\n    while (current <= end) {\n      if (!isNonWorkingDay(current)) {\n        count++;\n      }\n      current.setDate(current.getDate() + 1);\n    }\n    return count;\n  };\n\n  // Single source of truth for working days calculation (same as AssetSelector)\n  const calculateWorkingDaysBetween = (startDate, endDate) => {\n    if (!startDate || !endDate) return 0;\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    if (start >= end) return 0;\n    let workingDays = 0;\n    let currentDate = new Date(start);\n    while (currentDate < end) {\n      const dayOfWeek = currentDate.getDay();\n      // Count if not weekend (0 = Sunday, 6 = Saturday)\n      if (dayOfWeek !== 0 && dayOfWeek !== 6) {\n        workingDays++;\n      }\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n    return workingDays;\n  };\n\n  // Helper function to calculate task end date based on start date and duration\n  const calculateTaskEndDate = (startDate, duration) => {\n    let endDate = new Date(startDate);\n    let remainingDays = duration - 1; // -1 because we count the start date\n\n    while (remainingDays > 0) {\n      endDate.setDate(endDate.getDate() + 1);\n      if (!isNonWorkingDay(endDate)) {\n        remainingDays--;\n      }\n    }\n    return endDate.toISOString().split('T')[0];\n  };\n\n  // Calculate working days needed per asset for detailed timeline alerts\n  const calculateWorkingDaysNeededPerAsset = () => {\n    if (!globalLiveDate || timelineTasks.length === 0) return [];\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const assetAlerts = [];\n\n    // Calculate for each asset that has date errors\n    selectedAssets.forEach(asset => {\n      const calculatedStart = calculatedStartDates[asset.id];\n      if (calculatedStart && dateErrors.includes(asset.id)) {\n        const startDate = new Date(calculatedStart);\n        const daysInPast = calculateWorkingDaysBetween(startDate, today);\n        if (daysInPast > 0) {\n          assetAlerts.push({\n            assetId: asset.id,\n            assetName: asset.name,\n            assetType: asset.type,\n            daysNeeded: daysInPast,\n            daysSaved: 0,\n            // This would need to be calculated based on original vs current durations\n            startDate: calculatedStart,\n            isCritical: daysInPast > 5 // Mark as critical if more than 5 days needed\n          });\n        }\n      }\n    });\n\n    // Sort by urgency (most days needed first)\n    return assetAlerts.sort((a, b) => b.daysNeeded - a.daysNeeded);\n  };\n\n  // Single source of truth for working days needed (same as AssetSelector's getWorkingDaysToSave)\n  const calculateWorkingDaysNeeded = () => {\n    if (!globalLiveDate || timelineTasks.length === 0) return null;\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // Use the exact same logic as AssetSelector's getWorkingDaysToSave\n    let totalDaysInPast = 0;\n\n    // Only count assets that are in dateErrors (same as asset-specific calculation)\n    selectedAssets.forEach(asset => {\n      const calculatedStart = calculatedStartDates[asset.id];\n      if (calculatedStart && dateErrors.includes(asset.id)) {\n        const startDate = new Date(calculatedStart);\n        totalDaysInPast += calculateWorkingDaysBetween(startDate, today);\n      }\n    });\n\n    // Also check custom tasks that start in the past\n    timelineTasks.forEach(task => {\n      if (task.isCustom) {\n        const taskStart = new Date(task.start);\n        if (taskStart < today) {\n          totalDaysInPast += calculateWorkingDaysBetween(taskStart, today);\n        }\n      }\n    });\n    return {\n      available: 0,\n      // Not used in this calculation\n      allocated: 0,\n      // Not used in this calculation\n      needed: totalDaysInPast\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-gray-100 min-h-screen font-sans\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"bg-white shadow-md\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container mx-auto px-6 py-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-3xl font-bold text-gray-800\",\n            children: \"Accordion Timeline Builder\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1093,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: undo,\n              disabled: historyIndex <= 0,\n              className: \"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",\n              title: \"Undo (Ctrl+Z)\",\n              children: \"\\u21A9\\uFE0F Undo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1095,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: redo,\n              disabled: historyIndex >= history.length - 1,\n              className: \"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",\n              title: \"Redo (Ctrl+Y)\",\n              children: \"\\u21AA\\uFE0F Redo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1103,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1094,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1092,\n          columnNumber: 21\n        }, this), showInfoBox && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative mb-6 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-900\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"absolute top-2 right-2 text-blue-700 hover:text-blue-900 text-lg font-bold focus:outline-none\",\n            onClick: () => {\n              executeAction(() => setShowInfoBox(false), \"Hide instructions\");\n            },\n            \"aria-label\": \"Close instructions\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1116,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"How to Build Your Campaign Timeline:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1125,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n            className: \"list-decimal pl-5 mt-2 space-y-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Choose Your Campaign Start Date:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1128,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1128,\n                columnNumber: 86\n              }, this), \"If all assets launch on the same day, set a global start date and check \\u201CUse same live date for all assets.\\u201D\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1129,\n                columnNumber: 145\n              }, this), \"If assets launch on different days, uncheck the box and set dates individually for each asset.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1127,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Add Assets:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1133,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1133,\n                columnNumber: 65\n              }, this), \"Click \\u201CAdd\\u201D next to each asset type you need.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1134,\n                columnNumber: 82\n              }, this), \"Need the same asset type more than once? Click \\u201CAdd\\u201D again and give each a unique name.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1132,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Customize Assets:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1138,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1138,\n                columnNumber: 71\n              }, this), \"Rename each asset for clarity (e.g., \\u201CMetro Advertorial \\u2013 August\\u201D).\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1139,\n                columnNumber: 104\n              }, this), \"Set or confirm the start date for each asset.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1137,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Review Your Timeline:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1143,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1143,\n                columnNumber: 75\n              }, this), \"Remove any asset you don\\u2019t need.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1144,\n                columnNumber: 69\n              }, this), \"Check the timeline to ensure all assets are scheduled as planned.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1142,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Adjust Your Timeline if Needed:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1148,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1148,\n                columnNumber: 85\n              }, this), \"If an asset\\u2019s timeline can\\u2019t be completed by the selected start date, you\\u2019ll see a warning.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1149,\n                columnNumber: 128\n              }, this), \"\\u2013 You can either change the go-live date, or\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1150,\n                columnNumber: 81\n              }, this), \"\\u2013 Manually shorten the durations of individual tasks (\\u201Caccordion\\u201D your timeline) until the schedule fits.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1147,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Undo/Redo:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1154,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1154,\n                columnNumber: 64\n              }, this), \"Use Ctrl+Z to undo and Ctrl+Y to redo any changes you make.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1155,\n                columnNumber: 96\n              }, this), \"You can also use the Undo/Redo buttons in the top-right corner.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1153,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1126,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1115,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1091,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1090,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"container mx-auto p-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 lg:grid-cols-3 gap-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:col-span-1 bg-white p-6 rounded-xl shadow-lg overflow-x-auto\",\n          style: {\n            minWidth: 380\n          } // You can adjust 380 to your needs\n          ,\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\",\n            children: \"Timeline Setup\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1170,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(CampaignSetup, {\n            globalLiveDate: globalLiveDate,\n            onGlobalLiveDateChange: date => {\n              executeAction(() => setGlobalLiveDate(date), `Change global go-live date to ${date}`);\n            },\n            useGlobalDate: useGlobalDate,\n            onUseGlobalDateChange: useGlobal => {\n              executeAction(() => setUseGlobalDate(useGlobal), `Switch to ${useGlobal ? 'global' : 'individual'} date mode`);\n            },\n            projectStartDate: projectStartDate,\n            dateErrors: dateErrors,\n            workingDaysNeeded: calculateWorkingDaysNeeded()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1171,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(AssetSelector, {\n            assets: uniqueAssets || [],\n            selectedAssets: selectedAssets || [],\n            onAddAsset: handleAddAsset,\n            onRemoveAsset: handleRemoveAsset,\n            useGlobalDate: useGlobalDate,\n            globalLiveDate: globalLiveDate || '',\n            assetLiveDates: assetLiveDates || {},\n            onAssetLiveDateChange: handleAssetLiveDateChange,\n            calculatedStartDates: calculatedStartDates || {},\n            dateErrors: dateErrors || [],\n            onRenameAsset: handleRenameAsset,\n            onAssetStartDateChange: handleAssetStartDateChange,\n            csvData: csvData,\n            onSaveTaskDurations: handleSaveTaskDurations,\n            isNonWorkingDay: isNonWorkingDay,\n            calculateWorkingDaysBetween: calculateWorkingDaysBetween\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1184,\n            columnNumber: 1\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1166,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:col-span-2 bg-white p-6 rounded-xl shadow-lg\",\n          style: {\n            minWidth: 0,\n            maxWidth: \"100%\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\",\n            children: \"Generated Timeline\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1209,\n            columnNumber: 25\n          }, this), timelineTasks && timelineTasks.length > 0 ? /*#__PURE__*/_jsxDEV(GanttChart, {\n            tasks: timelineTasks,\n            bankHolidays: bankHolidays,\n            onTaskDurationChange: handleTaskDurationChange,\n            onTaskNameChange: handleRenameTask,\n            workingDaysNeeded: calculateWorkingDaysNeeded(),\n            assetAlerts: calculateWorkingDaysNeededPerAsset(),\n            onAddCustomTask: handleAddCustomTask\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1232,\n            columnNumber: 53\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center text-gray-500 py-10\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-lg\",\n              children: \"Your timeline will appear here.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1243,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm\",\n              children: \"Set a live date and select some assets to begin.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1244,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1242,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1205,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1164,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1163,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1089,\n    columnNumber: 9\n  }, this);\n};\n_s(TimelineBuilder, \"+q+94RSfNAIJkxbdLO2d3mQW3vQ=\");\n_c = TimelineBuilder;\nexport default TimelineBuilder;\nvar _c;\n$RefreshReg$(_c, \"TimelineBuilder\");","map":{"version":3,"names":["React","useState","useEffect","Papa","AssetSelector","CampaignSetup","GanttChart","jsxDEV","_jsxDEV","TimelineBuilder","_s","csvData","setCsvData","uniqueAssets","setUniqueAssets","selectedAssets","setSelectedAssets","globalLiveDate","setGlobalLiveDate","useGlobalDate","setUseGlobalDate","assetLiveDates","setAssetLiveDates","calculatedStartDates","setCalculatedStartDates","projectStartDate","setProjectStartDate","dateErrors","setDateErrors","timelineTasks","setTimelineTasks","showInfoBox","setShowInfoBox","assetTaskDurations","setAssetTaskDurations","customTasks","setCustomTasks","customTaskNames","setCustomTaskNames","bankHolidays","setBankHolidays","history","setHistory","historyIndex","setHistoryIndex","isUndoRedoAction","setIsUndoRedoAction","getTaskName","taskId","assetName","taskInfo","createStateSnapshot","actionDescription","snapshot","JSON","parse","stringify","timestamp","Date","now","actionType","console","log","length","restoreFromSnapshot","error","undefined","undo","validIndex","Math","min","previousSnapshot","redo","nextSnapshot","prev","filter","executeAction","action","description","currentSnapshot","newHistory","slice","newIndex","isNonWorkingDay","date","day","getDay","yyyy_mm_dd","toISOString","split","includes","getPreviousWorkingDay","workingDate","setDate","getDate","getNextWorkingDay","subtractWorkingDays","endDate","workingDaysToSubtract","currentDate","remainingDays","addWorkingDays","startDate","workingDaysToAdd","window","location","origin","download","header","skipEmptyLines","complete","results","parsedData","data","assetTypes","Set","map","row","type","fetch","then","response","json","events","tenYearsFromNow","getFullYear","getMonth","holidayDates","event","dateStr","catch","err","today","setHours","newCalculatedStartDates","newDateErrors","allStartDates","allTasks","forEach","asset","assetTasks","liveDate","isNaN","getTime","currentEndDate","ganttTasks","taskIndex","goLiveTaskId","id","unshift","name","start","end","progress","i","customDurations","duration","parseInt","taskStartDate","taskEndDate","finalTaskEndDate","push","earliestDate","assetTimeline","customTask","insertIndex","insertAfterTaskId","afterTaskIndex","findIndex","task","splice","finalTimeline","tasksByAsset","isCustom","targetAssetId","afterTask","find","t","_selectedAssets$","firstAssetId","assetId","goLiveTask","regularTasks","calculatedTasks","finalDateErrors","startsWith","earliestTask","reduce","earliest","allFinalStartDates","Object","values","handleKeyDown","e","ctrlKey","metaKey","key","shiftKey","preventDefault","document","addEventListener","removeEventListener","newLiveDates","updated","generateTimelineTasks","startDates","keys","newCustomTask","generateAssetId","random","handleAddAsset","assetType","newAsset","handleRemoveAsset","assetToRemove","handleRenameAsset","newName","assetToRename","handleRenameTask","currentTask","handleAssetLiveDateChange","handleAssetStartDateChange","newDate","assetToUpdate","handleSaveTaskDurations","durations","currentCustomTasks","handleTaskDurationChange","newDuration","newEndDate","taskName","a","currentDurations","handleAddCustomTask","customTaskData","newTaskId","newTask","countWorkingDays","count","current","calculateWorkingDaysBetween","workingDays","dayOfWeek","calculateTaskEndDate","calculateWorkingDaysNeededPerAsset","assetAlerts","calculatedStart","daysInPast","daysNeeded","daysSaved","isCritical","sort","b","calculateWorkingDaysNeeded","totalDaysInPast","taskStart","available","allocated","needed","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","title","style","minWidth","onGlobalLiveDateChange","onUseGlobalDateChange","useGlobal","workingDaysNeeded","assets","onAddAsset","onRemoveAsset","onAssetLiveDateChange","onRenameAsset","onAssetStartDateChange","onSaveTaskDurations","maxWidth","tasks","onTaskDurationChange","onTaskNameChange","onAddCustomTask","_c","$RefreshReg$"],"sources":["/Users/hamishnicklin/Accordion3F/src/TimelineBuilder.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Papa from 'papaparse';\nimport AssetSelector from './components/AssetSelector';\nimport CampaignSetup from './components/CampaignSetup';\nimport GanttChart from './components/GanttChart';\n\nconst TimelineBuilder = () => {\n    // CSV and asset data\n    const [csvData, setCsvData] = useState([]);\n    const [uniqueAssets, setUniqueAssets] = useState([]);\n    // Each selected asset is now an object with a unique id, type, name, and startDate\n    const [selectedAssets, setSelectedAssets] = useState([]);\n    \n    // Live date management\n    const [globalLiveDate, setGlobalLiveDate] = useState('');\n    const [useGlobalDate, setUseGlobalDate] = useState(true);\n    const [assetLiveDates, setAssetLiveDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n    \n    // Calculated results\n    const [calculatedStartDates, setCalculatedStartDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n    const [projectStartDate, setProjectStartDate] = useState(''); // Earliest start date across all assets\n    const [dateErrors, setDateErrors] = useState([]); // Array of asset names that start before today\n    \n    // Final timeline for display\n    const [timelineTasks, setTimelineTasks] = useState([]);\n    const [showInfoBox, setShowInfoBox] = useState(true); // Add state for info box\n\n    // Add state to store custom task durations for each asset instance\n    const [assetTaskDurations, setAssetTaskDurations] = useState({}); // { assetId: { taskName: duration, ... } }\n\n    // Add state to store custom tasks separately\n    const [customTasks, setCustomTasks] = useState([]); // Array of custom task objects\n\n    // Add state to store custom task names\n    const [customTaskNames, setCustomTaskNames] = useState({}); // { taskId: customName }\n\n    // Add state to store bank holidays\n    const [bankHolidays, setBankHolidays] = useState([]); // Array of YYYY-MM-DD strings\n\n    // State for undo/redo functionality\n    const [history, setHistory] = useState([]);\n    const [historyIndex, setHistoryIndex] = useState(-1);\n    const [isUndoRedoAction, setIsUndoRedoAction] = useState(false);\n\n    // Helper function to get task name (custom or default)\n    const getTaskName = (taskId, assetName, taskInfo) => {\n        // Check if there's a custom name for this task\n        if (customTaskNames[taskId]) {\n            return customTaskNames[taskId];\n        }\n        // Return default format\n        return `${assetName}: ${taskInfo['Task']}`;\n    };\n\n    // Create a snapshot of the current app state for undo/redo\n    const createStateSnapshot = (actionDescription) => {\n        const snapshot = {\n            // Asset state\n            selectedAssets: JSON.parse(JSON.stringify(selectedAssets)),\n            assetLiveDates: JSON.parse(JSON.stringify(assetLiveDates)),\n            useGlobalDate,\n            globalLiveDate,\n            \n            // Task state\n            customTaskNames: JSON.parse(JSON.stringify(customTaskNames)),\n            assetTaskDurations: JSON.parse(JSON.stringify(assetTaskDurations)),\n            customTasks: JSON.parse(JSON.stringify(customTasks)),\n            \n            // UI state\n            showInfoBox,\n            \n            // Calculated state (will be recalculated after restoration)\n            timelineTasks: JSON.parse(JSON.stringify(timelineTasks)),\n            calculatedStartDates: JSON.parse(JSON.stringify(calculatedStartDates)),\n            dateErrors: JSON.parse(JSON.stringify(dateErrors)),\n            projectStartDate,\n            \n            // Metadata\n            timestamp: Date.now(),\n            actionDescription,\n            actionType: 'user_action'\n        };\n        \n        console.log('Creating snapshot with action:', actionDescription);\n        console.log('Snapshot customTasks length:', snapshot.customTasks.length);\n        console.log('Snapshot customTasks:', snapshot.customTasks);\n        \n        return snapshot;\n    };\n\n    // Restore app state from a snapshot\n    const restoreFromSnapshot = (snapshot) => {\n        console.log('restoreFromSnapshot called with:', snapshot);\n        \n        // Validate snapshot before restoring\n        if (!snapshot || typeof snapshot !== 'object') {\n            console.error('Invalid snapshot provided to restoreFromSnapshot');\n            return;\n        }\n        \n        console.log('Restoring state from snapshot...');\n        \n        // Restore only the input state (what the user controls)\n        if (snapshot.selectedAssets) {\n            console.log('Restoring selectedAssets:', snapshot.selectedAssets);\n            setSelectedAssets(snapshot.selectedAssets);\n        }\n        if (snapshot.assetLiveDates) {\n            console.log('Restoring assetLiveDates:', snapshot.assetLiveDates);\n            setAssetLiveDates(snapshot.assetLiveDates);\n        }\n        if (snapshot.useGlobalDate !== undefined) {\n            console.log('Restoring useGlobalDate:', snapshot.useGlobalDate);\n            setUseGlobalDate(snapshot.useGlobalDate);\n        }\n        if (snapshot.globalLiveDate) {\n            console.log('Restoring globalLiveDate:', snapshot.globalLiveDate);\n            setGlobalLiveDate(snapshot.globalLiveDate);\n        }\n        if (snapshot.customTaskNames) {\n            console.log('Restoring customTaskNames:', snapshot.customTaskNames);\n            setCustomTaskNames(snapshot.customTaskNames);\n        }\n        if (snapshot.assetTaskDurations) {\n            console.log('Restoring assetTaskDurations:', snapshot.assetTaskDurations);\n            setAssetTaskDurations(snapshot.assetTaskDurations);\n        }\n        if (snapshot.customTasks) {\n            console.log('Restoring customTasks:', snapshot.customTasks);\n            setCustomTasks(snapshot.customTasks);\n        }\n        if (snapshot.showInfoBox !== undefined) {\n            console.log('Restoring showInfoBox:', snapshot.showInfoBox);\n            setShowInfoBox(snapshot.showInfoBox);\n        }\n        \n        console.log('State restoration complete');\n        \n        // Don't restore calculated state - let the useEffect recalculate it fresh\n        // This prevents conflicts between old calculated state and new input state\n        // setTimelineTasks(snapshot.timelineTasks);\n        // setCalculatedStartDates(snapshot.calculatedStartDates);\n        // setDateErrors(snapshot.dateErrors);\n        // setProjectStartDate(snapshot.projectStartDate);\n    };\n\n    // Undo function\n    const undo = () => {\n        console.log('undo called');\n        console.log('Current history length:', history.length, 'historyIndex:', historyIndex);\n        console.log('History array:', history);\n        \n        if (historyIndex > 0 && history.length > 0) {\n            console.log('Attempting undo to index:', historyIndex - 1);\n            \n            // Ensure historyIndex doesn't exceed history length\n            const validIndex = Math.min(historyIndex - 1, history.length - 1);\n            console.log('Using valid index:', validIndex);\n            \n            const previousSnapshot = history[validIndex];\n            console.log('Previous snapshot:', previousSnapshot);\n            \n            if (previousSnapshot && previousSnapshot.selectedAssets) {\n                console.log('Restoring from snapshot');\n                setIsUndoRedoAction(true);\n                restoreFromSnapshot(previousSnapshot);\n                setHistoryIndex(validIndex);\n                setIsUndoRedoAction(false);\n            } else {\n                console.error('Invalid snapshot found in history during undo');\n            }\n        } else {\n            console.log('Cannot undo: historyIndex <= 0 or no previous snapshot');\n            console.log('historyIndex:', historyIndex);\n            console.log('history.length:', history.length);\n        }\n    };\n\n    // Redo function\n    const redo = () => {\n        if (historyIndex < history.length - 1 && history[historyIndex + 1]) {\n            setIsUndoRedoAction(true);\n            const nextSnapshot = history[historyIndex + 1];\n            if (nextSnapshot && nextSnapshot.selectedAssets) {\n                restoreFromSnapshot(nextSnapshot);\n                setHistoryIndex(prev => prev + 1);\n            } else {\n                console.error('Invalid snapshot found in history during redo');\n                // Remove the invalid snapshot and try again\n                setHistory(prev => prev.filter(snapshot => snapshot && snapshot.selectedAssets));\n                setHistoryIndex(prev => Math.min(prev, history.length - 1));\n            }\n            setIsUndoRedoAction(false);\n        }\n    };\n\n    // Execute an action and save it to history\n    const executeAction = (action, description) => {\n        console.log('executeAction called with:', description);\n        console.log('Current history length:', history.length, 'historyIndex:', historyIndex);\n        \n        // Execute the action\n        action();\n        \n        // Create a snapshot of current state AFTER executing the action\n        const currentSnapshot = createStateSnapshot(description);\n        console.log('Created snapshot:', currentSnapshot);\n        \n        // Add to history (but not during undo/redo operations)\n        if (!isUndoRedoAction) {\n            console.log('Adding to history (not undo/redo action)');\n            setHistory(prev => {\n                const newHistory = [...prev.slice(0, historyIndex + 1), currentSnapshot];\n                console.log('New history length:', newHistory.length);\n                console.log('New history array:', newHistory);\n                return newHistory;\n            });\n            setHistoryIndex(prev => {\n                const newIndex = prev + 1;\n                console.log('New history index:', newIndex);\n                return newIndex;\n            });\n        } else {\n            console.log('Skipping history update (undo/redo action)');\n        }\n    };\n\n    // Helper function to check if date is a non-working day (weekend or bank holiday)\n    const isNonWorkingDay = (date) => {\n        const day = date.getDay();\n        const yyyy_mm_dd = date.toISOString().split('T')[0];\n        return day === 0 || day === 6 || bankHolidays.includes(yyyy_mm_dd);\n    };\n\n    // Helper function to get previous working day\n    const getPreviousWorkingDay = (date) => {\n        let workingDate = new Date(date);\n        do {\n            workingDate.setDate(workingDate.getDate() - 1);\n        } while (isNonWorkingDay(workingDate));\n        return workingDate;\n    };\n\n    // Helper function to get next working day\n    const getNextWorkingDay = (date) => {\n        let workingDate = new Date(date);\n        do {\n            workingDate.setDate(workingDate.getDate() + 1);\n        } while (isNonWorkingDay(workingDate));\n        return workingDate;\n    };\n\n    // Helper function to subtract working days (backwards calculation)\n    const subtractWorkingDays = (endDate, workingDaysToSubtract) => {\n        let currentDate = new Date(endDate);\n        let remainingDays = workingDaysToSubtract;\n        // Subtract working days\n        while (remainingDays > 0) {\n            currentDate.setDate(currentDate.getDate() - 1);\n            // Only count non-non-working days\n            if (!isNonWorkingDay(currentDate)) {\n                remainingDays--;\n            }\n        }\n        return currentDate;\n    };\n\n    // Helper function to add working days (forward calculation for display)\n    const addWorkingDays = (startDate, workingDaysToAdd) => {\n        if (workingDaysToAdd <= 0) {\n            return new Date(startDate);\n        }\n        let currentDate = new Date(startDate);\n        let remainingDays = workingDaysToAdd - 1;\n        while (remainingDays > 0) {\n            currentDate.setDate(currentDate.getDate() + 1);\n            if (!isNonWorkingDay(currentDate)) {\n                remainingDays--;\n            }\n        }\n        // Ensure the final day is a working day\n        while (isNonWorkingDay(currentDate)) {\n            currentDate.setDate(currentDate.getDate() + 1);\n        }\n        return currentDate;\n    };\n\n    // Load CSV data\n    useEffect(() => {\n        Papa.parse(`${window.location.origin}/Group_Asset_Task_Time.csv`, {\n            download: true,\n            header: true,\n            skipEmptyLines: true,\n            complete: (results) => {\n                const parsedData = results.data;\n                setCsvData(parsedData);\n                \n                // Extract unique asset types from CSV\n                const assetTypes = [...new Set(parsedData.map(row => row['Asset Type']))].filter(type => type);\n                setUniqueAssets(assetTypes);\n            },\n            error: (error) => {\n                console.error(\"Error parsing CSV file:\", error);\n            }\n        });\n    }, []);\n\n    // Fetch UK bank holidays for England and Wales on app load\n    useEffect(() => {\n        fetch('https://www.gov.uk/bank-holidays.json')\n            .then(response => response.json())\n            .then(data => {\n                // Get all dates for England and Wales\n                const events = data['england-and-wales'].events;\n                // Get all dates for the next 10 years\n                const now = new Date();\n                const tenYearsFromNow = new Date(now.getFullYear() + 10, now.getMonth(), now.getDate());\n                const holidayDates = events\n                    .map(event => event.date)\n                    .filter(dateStr => {\n                        const date = new Date(dateStr);\n                        return date >= now && date <= tenYearsFromNow;\n                    });\n                setBankHolidays(holidayDates);\n            })\n            .catch(err => {\n                // If fetch fails, fallback to an empty array (or you could use a static list)\n                setBankHolidays([]);\n            });\n    }, []);\n\n    // Calculate backwards timeline when live dates or assets change\n    useEffect(() => {\n        if (selectedAssets.length === 0 || csvData.length === 0) {\n            setTimelineTasks([]);\n            setCalculatedStartDates({});\n            setProjectStartDate('');\n            setDateErrors([]);\n            return;\n        }\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0); // Reset time for accurate comparison\n        \n        const newCalculatedStartDates = {};\n        const newDateErrors = [];\n        const allStartDates = [];\n        const allTasks = [];\n\n        // Loop over each selected asset instance (not just type)\n        selectedAssets.forEach(asset => {\n            // asset: { id, type, name, startDate }\n            if (!asset.startDate) return; // Skip if no start date set\n\n            // Find all tasks for this asset type from the CSV\n            const assetTasks = csvData.filter(row => row['Asset Type'] === asset.type);\n            if (assetTasks.length === 0) return;\n\n            // Use the asset instance's startDate as the go-live date\n            const liveDate = new Date(asset.startDate);\n            if (isNaN(liveDate.getTime())) return;\n\n            // We'll build the tasks in reverse (from go-live backwards)\n            let currentEndDate = new Date(liveDate);\n            const ganttTasks = [];\n            let taskIndex = 0;\n\n            // Go-live task (single day)\n            const goLiveTaskId = `${asset.id}-go-live`;\n            ganttTasks.unshift({\n                id: goLiveTaskId,\n                name: getTaskName(goLiveTaskId, asset.name, { 'Task': 'Go-Live' }),\n                start: liveDate.toISOString().split('T')[0],\n                end: liveDate.toISOString().split('T')[0],\n                progress: 0,\n            });\n            taskIndex++;\n\n            // Process all other tasks in reverse order\n            for (let i = assetTasks.length - 1; i >= 0; i--) {\n                const taskInfo = assetTasks[i];\n                // Use custom duration if present, else default from CSV\n                // Use asset.type as the key to match CSV task names consistently\n                const customDurations = assetTaskDurations[asset.type] || {};\n                const duration = customDurations[taskInfo['Task']] !== undefined\n                    ? customDurations[taskInfo['Task']]\n                    : parseInt(taskInfo['Duration (Days)'], 10) || 1;\n                // Subtract working days to get the start date\n                const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                // Task ends the working day before currentEndDate\n                const taskEndDate = new Date(currentEndDate);\n                taskEndDate.setDate(taskEndDate.getDate() - 1);\n                // Ensure end date is a working day\n                let finalTaskEndDate = new Date(taskEndDate);\n                if (isNonWorkingDay(finalTaskEndDate)) {\n                    finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                }\n                const taskId = `${asset.id}-task-${taskIndex}`;\n                ganttTasks.unshift({\n                    id: taskId,\n                    name: getTaskName(taskId, asset.name, taskInfo),\n                    start: taskStartDate.toISOString().split('T')[0],\n                    end: finalTaskEndDate.toISOString().split('T')[0],\n                    progress: 0,\n                });\n                taskIndex++;\n                // Update currentEndDate for the next task\n                currentEndDate = new Date(taskStartDate);\n            }\n\n            // Add all tasks for this asset instance to the main list\n            allTasks.push(...ganttTasks);\n\n            // Set the calculated start date for this asset to the start date of the first (earliest) task\n            if (ganttTasks.length > 0 && ganttTasks[0].start) {\n                newCalculatedStartDates[asset.id] = ganttTasks[0].start;\n                allStartDates.push(new Date(ganttTasks[0].start));\n            }\n\n            // Check if start date is before today\n            if (ganttTasks.length > 0 && new Date(ganttTasks[0].start) < today) {\n                newDateErrors.push(asset.id);\n            }\n        });\n\n        // Find earliest start date across all assets\n        if (allStartDates.length > 0) {\n            const earliestDate = new Date(Math.min(...allStartDates));\n            setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n        }\n\n        // Handle custom tasks by integrating them into the timeline\n        if (customTasks.length > 0) {\n            console.log('Processing custom tasks:', customTasks);\n            \n            // First, create a simple timeline with all asset tasks\n            const assetTimeline = [...allTasks];\n            console.log('Initial asset timeline:', assetTimeline);\n            \n            // Insert custom tasks at their specified positions\n            customTasks.forEach(customTask => {\n                let insertIndex = 0;\n                if (customTask.insertAfterTaskId) {\n                    const afterTaskIndex = assetTimeline.findIndex(task => task.id === customTask.insertAfterTaskId);\n                    console.log('Looking for insertAfterTaskId:', customTask.insertAfterTaskId, 'found at index:', afterTaskIndex);\n                    if (afterTaskIndex !== -1) {\n                        insertIndex = afterTaskIndex + 1;\n                    }\n                }\n                \n                console.log('Inserting custom task at index:', insertIndex);\n                \n                // Insert the custom task (without dates for now)\n                assetTimeline.splice(insertIndex, 0, {\n                    ...customTask,\n                    start: '', // Will be calculated below\n                    end: ''    // Will be calculated below\n                });\n            });\n            \n            console.log('Timeline after inserting custom tasks:', assetTimeline);\n            \n            // Now rebuild the timeline backwards from go-live to maintain constraints\n            const finalTimeline = [];\n            \n            // Group tasks by asset to maintain the backwards calculation\n            const tasksByAsset = {};\n            assetTimeline.forEach(task => {\n                if (task.isCustom) {\n                    // Custom tasks need to be associated with the asset they belong to\n                    // Find which asset this custom task belongs to based on insertAfterTaskId\n                    let targetAssetId = null;\n                    if (task.insertAfterTaskId) {\n                        const afterTask = assetTimeline.find(t => t.id === task.insertAfterTaskId);\n                        if (afterTask) {\n                            targetAssetId = afterTask.id.split('-')[0];\n                        }\n                    }\n                    \n                    if (targetAssetId) {\n                        if (!tasksByAsset[targetAssetId]) tasksByAsset[targetAssetId] = [];\n                        tasksByAsset[targetAssetId].push(task);\n                    } else {\n                        // Fallback: associate with the first asset\n                        const firstAssetId = selectedAssets[0]?.id;\n                        if (firstAssetId) {\n                            if (!tasksByAsset[firstAssetId]) tasksByAsset[firstAssetId] = [];\n                            tasksByAsset[firstAssetId].push(task);\n                        }\n                    }\n                } else {\n                    // Asset tasks are grouped by their asset ID\n                    const assetId = task.id.split('-')[0];\n                    if (!tasksByAsset[assetId]) tasksByAsset[assetId] = [];\n                    tasksByAsset[assetId].push(task);\n                }\n            });\n            \n            console.log('Tasks grouped by asset:', tasksByAsset);\n            \n            // Rebuild each asset's timeline backwards from go-live\n            selectedAssets.forEach(asset => {\n                const assetTasks = tasksByAsset[asset.id] || [];\n                if (assetTasks.length === 0) return;\n                \n                console.log(`Processing asset ${asset.id} with tasks:`, assetTasks);\n                \n                // Separate go-live task from other tasks\n                const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n                const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n                \n                // Build backwards from go-live to calculate dates\n                let currentEndDate = new Date(asset.startDate);\n                const calculatedTasks = [];\n                \n                // Calculate dates for regular tasks in reverse order (backwards from go-live)\n                for (let i = regularTasks.length - 1; i >= 0; i--) {\n                    const task = regularTasks[i];\n                    \n                    if (task.isCustom) {\n                        // Custom task - calculate backwards from current end date\n                        const taskStartDate = subtractWorkingDays(currentEndDate, task.duration);\n                        const taskEndDate = new Date(currentEndDate);\n                        taskEndDate.setDate(taskEndDate.getDate() - 1);\n                        \n                        // Ensure end date is a working day\n                        let finalTaskEndDate = new Date(taskEndDate);\n                        if (isNonWorkingDay(finalTaskEndDate)) {\n                            finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                        }\n                        \n                        calculatedTasks.unshift({\n                            ...task,\n                            start: taskStartDate.toISOString().split('T')[0],\n                            end: finalTaskEndDate.toISOString().split('T')[0]\n                        });\n                        \n                        currentEndDate = new Date(taskStartDate);\n                    } else {\n                        // Regular asset task\n                        const taskInfo = csvData.find(row => \n                            row['Asset Type'] === asset.type && \n                            row['Task'] === task.name.split(': ')[1]\n                        );\n                        \n                        // Use manual duration override if available\n                        const customDurations = assetTaskDurations[asset.type] || {};\n                        const duration = customDurations[taskInfo?.['Task']] !== undefined\n                            ? customDurations[taskInfo['Task']]\n                            : parseInt(taskInfo?.['Duration (Days)'], 10) || 1;\n                        \n                        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                        const taskEndDate = new Date(currentEndDate);\n                        taskEndDate.setDate(taskEndDate.getDate() - 1);\n                        \n                        // Ensure end date is a working day\n                        let finalTaskEndDate = new Date(taskEndDate);\n                        if (isNonWorkingDay(finalTaskEndDate)) {\n                            finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                        }\n                        \n                        calculatedTasks.unshift({\n                            ...task,\n                            start: taskStartDate.toISOString().split('T')[0],\n                            end: finalTaskEndDate.toISOString().split('T')[0]\n                        });\n                        \n                        currentEndDate = new Date(taskStartDate);\n                    }\n                }\n                \n                // Add go-live task at the end\n                if (goLiveTask) {\n                    calculatedTasks.push({\n                        ...goLiveTask,\n                        start: asset.startDate,\n                        end: asset.startDate\n                    });\n                }\n                \n                // Add all tasks to final timeline in correct order\n                finalTimeline.push(...calculatedTasks);\n            });\n            \n            console.log('Final timeline with custom tasks:', finalTimeline);\n            setTimelineTasks(finalTimeline);\n            \n            // Update calculated start dates and date errors\n            const finalDateErrors = [];\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            \n            selectedAssets.forEach(asset => {\n                // Get all tasks for this asset (including custom tasks)\n                const assetTasks = finalTimeline.filter(task => {\n                    // Regular asset tasks\n                    if (task.id.startsWith(`${asset.id}-`) && !task.name.includes('Go-Live')) {\n                        return true;\n                    }\n                    // Custom tasks that belong to this asset\n                    if (task.isCustom && task.insertAfterTaskId) {\n                        const afterTask = finalTimeline.find(t => t.id === task.insertAfterTaskId);\n                        if (afterTask && afterTask.id.startsWith(`${asset.id}-`)) {\n                            return true;\n                        }\n                    }\n                    return false;\n                });\n                \n                if (assetTasks.length > 0) {\n                    // Find the earliest task for this asset\n                    const earliestTask = assetTasks.reduce((earliest, task) => {\n                        return new Date(task.start) < new Date(earliest.start) ? task : earliest;\n                    });\n                    \n                    // Update calculated start date\n                    newCalculatedStartDates[asset.id] = earliestTask.start;\n                    \n                    // Check if start date is before today\n                    if (new Date(earliestTask.start) < today) {\n                        finalDateErrors.push(asset.id);\n                    }\n                }\n            });\n            \n            setCalculatedStartDates(newCalculatedStartDates);\n            setDateErrors(finalDateErrors);\n            \n            // Update the global project start date to reflect the new earliest start date\n            const allFinalStartDates = Object.values(newCalculatedStartDates).map(date => new Date(date));\n            if (allFinalStartDates.length > 0) {\n                const earliestDate = new Date(Math.min(...allFinalStartDates));\n                setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n            }\n        } else {\n            setTimelineTasks(allTasks);\n            setCalculatedStartDates(newCalculatedStartDates);\n            setDateErrors(newDateErrors);\n        }\n    }, [selectedAssets, globalLiveDate, useGlobalDate, assetLiveDates, csvData, assetTaskDurations, customTaskNames, customTasks]);\n\n    // Keyboard shortcuts for undo/redo\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                undo();\n            }\n            if (((e.ctrlKey || e.metaKey) && e.key === 'y') || \n                ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z')) {\n                e.preventDefault();\n                redo();\n            }\n        };\n        \n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [historyIndex, history.length]);\n// This new useEffect pre-populates individual dates when switching from global mode\n    useEffect(() => {\n        if (!useGlobalDate && globalLiveDate && selectedAssets.length > 0) {\n            const newLiveDates = { ...assetLiveDates };\n            let updated = false;\n            selectedAssets.forEach(asset => {\n                // Pre-fill only if the asset doesn't have an individual date set\n                if (!newLiveDates[asset.name]) { // Changed to asset.name\n                    newLiveDates[asset.name] = globalLiveDate; // Changed to asset.name\n                    updated = true;\n                }\n            });\n            if (updated) {\n                setAssetLiveDates(newLiveDates);\n            }\n        }\n    }, [useGlobalDate, globalLiveDate, selectedAssets, assetLiveDates]);\n\n    // Sync all asset instance startDates to globalLiveDate if useGlobalDate is true\nuseEffect(() => {\n    if (useGlobalDate && globalLiveDate && !isUndoRedoAction) {\n        setSelectedAssets(prev =>\n            prev.map(asset =>\n                asset.startDate !== globalLiveDate\n                    ? { ...asset, startDate: globalLiveDate }\n                    : asset\n            )\n        );\n    }\n    // Optionally, if unchecked, you could clear the dates or leave as-is\n}, [useGlobalDate, globalLiveDate, isUndoRedoAction]);\n\n    // Custom tasks are handled directly in the main timeline calculation useEffect\n    // No need for a separate preserve useEffect that creates circular dependencies\n\n    // Keep historyIndex in sync with history length\n    useEffect(() => {\n        if (historyIndex >= history.length && history.length > 0) {\n            console.log('Fixing out-of-sync historyIndex:', historyIndex, '->', history.length - 1);\n            setHistoryIndex(history.length - 1);\n        }\n    }, [history, historyIndex]);\n\n    // Handle pending actions and create snapshots after state updates\n    useEffect(() => {\n        // This useEffect is no longer needed as pendingAction state is removed.\n        // The history state will now directly reflect the state after each action.\n    }, [customTasks, selectedAssets, assetLiveDates, useGlobalDate, globalLiveDate, customTaskNames, assetTaskDurations, showInfoBox, historyIndex, isUndoRedoAction]);\n\n    // REMOVED: Separate custom task merging useEffect\n    // Custom tasks are now integrated directly into the main timeline calculation\n\n    // REMOVED: Custom task merging useEffect that was causing timeline disruption\n    // Custom tasks are now handled properly in the main timeline calculation\n    // Generate timeline tasks for Gantt chart\n    const generateTimelineTasks = (startDates) => {\n        if (selectedAssets.length === 0 || Object.keys(startDates).length === 0) {\n            setTimelineTasks([]);\n            return;\n        }\n\n        const allTasks = [];\n        let taskIndex = 0;\n\n        selectedAssets.forEach(asset => {\n            const assetName = asset.name; // Assuming asset object has a 'name' property\n            const assetTasks = csvData.filter(row => row['Asset Type'] === assetName);\n            if (assetTasks.length === 0) return;\n\n            // Get the correct live date for this asset\n            const liveDate = new Date(useGlobalDate ? globalLiveDate : assetLiveDates[assetName]);\n            if (isNaN(liveDate.getTime())) return;\n\n            // We'll build the tasks in reverse (from go-live backwards)\n            let currentEndDate = new Date(liveDate);\n            const ganttTasks = [];\n            let taskIndex = 0;\n\n            // Go-live task (single day)\n            ganttTasks.unshift({\n                id: `task-${taskIndex}`,\n                name: `${assetName}: Go-Live`,\n                start: liveDate.toISOString().split('T')[0],\n                end: liveDate.toISOString().split('T')[0],\n                progress: 0,\n            });\n            taskIndex++;\n\n            // Process all other tasks in reverse order\n            for (let i = assetTasks.length - 1; i >= 0; i--) {\n                const taskInfo = assetTasks[i];\n                const duration = parseInt(taskInfo['Duration (Days)'], 10) || 1;\n                // Subtract working days to get the start date\n                const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                // Task ends the working day before currentEndDate\n                const taskEndDate = new Date(currentEndDate);\n                taskEndDate.setDate(taskEndDate.getDate() - 1);\n                // Ensure end date is a working day\n                let finalTaskEndDate = new Date(taskEndDate);\n                if (isNonWorkingDay(finalTaskEndDate)) {\n                    finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                }\n                ganttTasks.unshift({\n                    id: `task-${taskIndex}`,\n                    name: `${taskInfo['Asset Type']}: ${taskInfo['Task']}`,\n                    start: taskStartDate.toISOString().split('T')[0],\n                    end: finalTaskEndDate.toISOString().split('T')[0],\n                    progress: 0,\n                });\n                taskIndex++;\n                // Update currentEndDate for the next task\n                currentEndDate = new Date(taskStartDate);\n            }\n\n            // Add all tasks for this asset to the main list\n            allTasks.push(...ganttTasks);\n\n            // Set the calculated start date for this asset to the start date of the first (earliest) task\n            if (ganttTasks.length > 0 && ganttTasks[0].start) {\n                newCalculatedStartDates[assetName] = ganttTasks[0].start;\n            }\n        });\n        \n        // Merge custom tasks back into the timeline\n        if (customTasks.length > 0) {\n            // Insert custom tasks at their specified positions\n            customTasks.forEach(customTask => {\n                let insertIndex = 0;\n                if (customTask.insertAfterTaskId) {\n                    const afterTaskIndex = allTasks.findIndex(task => task.id === customTask.insertAfterTaskId);\n                    if (afterTaskIndex !== -1) {\n                        insertIndex = afterTaskIndex + 1;\n                    }\n                }\n                \n                // Create a new custom task with updated dates\n                const newCustomTask = {\n                    ...customTask,\n                    id: customTask.id, // Keep the same ID\n                    name: customTask.name,\n                    duration: customTask.duration,\n                    isCustom: true\n                };\n                \n                // Insert the custom task\n                allTasks.splice(insertIndex, 0, newCustomTask);\n            });\n            \n            // Recalculate all task dates to accommodate custom tasks\n            // This is a simplified version - in practice, you'd want to recalculate dates\n            // based on the new timeline structure\n        }\n        \n        setCalculatedStartDates(newCalculatedStartDates);\n        setTimelineTasks(allTasks);\n    };\n\n    // Helper to generate a unique id (could use a counter or Date.now())\n    const generateAssetId = () => Date.now() + Math.random();\n\n    // Add a new asset instance\n    const handleAddAsset = (assetType) => {\n        executeAction(() => {\n            const newAsset = {\n                id: generateAssetId(),\n                type: assetType,\n                name: assetType, // default name, can be edited later\n                startDate: useGlobalDate && globalLiveDate ? globalLiveDate : ''\n            };\n            setSelectedAssets(prev => [...prev, newAsset]);\n        }, `Add ${assetType} asset`);\n    };\n\n    // Remove an asset instance by id\n    const handleRemoveAsset = (assetId) => {\n        const assetToRemove = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev => prev.filter(asset => asset.id !== assetId));\n        }, `Remove ${assetToRemove?.name || 'asset'}`);\n    };\n\n    // Handler to rename an asset instance by id\n    const handleRenameAsset = (assetId, newName) => {\n        const assetToRename = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev =>\n                prev.map(asset =>\n                    asset.id === assetId ? { ...asset, name: newName } : asset\n                )\n            );\n        }, `Rename asset to \"${newName}\"`);\n    };\n\n    // Handler to rename a task\n    const handleRenameTask = (taskId, newName) => {\n        const currentTask = timelineTasks.find(task => task.id === taskId);\n        executeAction(() => {\n            setCustomTaskNames(prev => ({\n                ...prev,\n                [taskId]: newName\n            }));\n        }, `Rename task to \"${newName}\"`);\n    };\n\n    const handleAssetLiveDateChange = (assetName, date) => {\n        executeAction(() => {\n            setAssetLiveDates(prev => ({\n                ...prev,\n                [assetName]: date\n            }));\n        }, `Change ${assetName} go-live date to ${date}`);\n    };\n\n    const handleAssetStartDateChange = (assetId, newDate) => {\n        const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev =>\n                prev.map(asset =>\n                    asset.id === assetId ? { ...asset, startDate: newDate } : asset\n                )\n            );\n        }, `Change ${assetToUpdate?.name || 'asset'} go-live date to ${newDate}`);\n    };\n\n    // Handler to save custom task durations for an asset\n    const handleSaveTaskDurations = (assetId, durations) => {\n        const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setAssetTaskDurations(prev => ({ ...prev, [assetId]: durations }));\n            \n            // Preserve custom tasks before timeline recalculation\n            const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n            setCustomTasks(currentCustomTasks);\n        }, `Update task durations for ${assetToUpdate?.name || 'asset'}`);\n    };\n\n    // Handler for drag-to-resize task duration\n    const handleTaskDurationChange = (taskId, newDuration, newEndDate) => {\n        // Find the task being modified\n        const taskIndex = timelineTasks.findIndex(task => task.id === taskId);\n        if (taskIndex === -1) return;\n\n        const task = timelineTasks[taskIndex];\n        const taskName = task.name.split(': ')[1]; // Get task name after the colon\n        const assetName = task.name.split(': ')[0]; // Get asset name before the colon\n        \n        // Find the asset by name\n        const asset = selectedAssets.find(a => a.name === assetName);\n        if (!asset) return;\n        \n        executeAction(() => {\n            // Update the assetTaskDurations state to trigger the same recalculation logic\n            // that the manual duration editing uses\n            // Use asset.type as the key to match CSV task names consistently\n            setAssetTaskDurations(prev => {\n                const currentDurations = prev[asset.type] || {};\n                return {\n                    ...prev,\n                    [asset.type]: {\n                        ...currentDurations,\n                        [taskName]: newDuration\n                    }\n                };\n            });\n        }, `Change ${taskName} duration to ${newDuration} days`);\n    };\n\n    // Handler for adding custom tasks\n    const handleAddCustomTask = (customTaskData) => {\n        const { name, duration, insertAfterTaskId } = customTaskData;\n        \n        console.log('handleAddCustomTask called with:', customTaskData);\n        \n        executeAction(() => {\n            // Create the new custom task\n            const newTaskId = `custom-task-${Date.now()}`;\n            \n            const newTask = {\n                id: newTaskId,\n                name: `Custom: ${name}`,\n                duration: duration,\n                insertAfterTaskId: insertAfterTaskId,\n                isCustom: true,\n                progress: 0\n            };\n            \n            console.log('Created new custom task:', newTask);\n            \n            // Add to custom tasks - this will trigger the main timeline calculation useEffect\n            setCustomTasks(prev => {\n                const updated = [...prev, newTask];\n                console.log('Updated customTasks:', updated);\n                return updated;\n            });\n            \n            // Don't manually insert into timelineTasks here - let the main useEffect handle it\n            // This ensures proper timeline recalculation and date adjustments\n        }, `Add custom task \"${name}\"`);\n    };\n\n        // Helper function to count working days between two dates (exclusive)\n    const countWorkingDays = (startDate, endDate) => {\n        let count = 0;\n        const current = new Date(startDate);\n        const end = new Date(endDate);\n\n        // Move to next day to make it exclusive\n        current.setDate(current.getDate() + 1);\n\n        while (current <= end) {\n            if (!isNonWorkingDay(current)) {\n                count++;\n            }\n            current.setDate(current.getDate() + 1);\n        }\n        return count;\n    };\n\n    // Single source of truth for working days calculation (same as AssetSelector)\n    const calculateWorkingDaysBetween = (startDate, endDate) => {\n        if (!startDate || !endDate) return 0;\n       \n        const start = new Date(startDate);\n        const end = new Date(endDate);\n       \n        if (start >= end) return 0;\n       \n        let workingDays = 0;\n        let currentDate = new Date(start);\n       \n        while (currentDate < end) {\n            const dayOfWeek = currentDate.getDay();\n            // Count if not weekend (0 = Sunday, 6 = Saturday)\n            if (dayOfWeek !== 0 && dayOfWeek !== 6) {\n                workingDays++;\n            }\n            currentDate.setDate(currentDate.getDate() + 1);\n        }\n       \n        return workingDays;\n    };\n\n    // Helper function to calculate task end date based on start date and duration\n    const calculateTaskEndDate = (startDate, duration) => {\n        let endDate = new Date(startDate);\n        let remainingDays = duration - 1; // -1 because we count the start date\n        \n        while (remainingDays > 0) {\n            endDate.setDate(endDate.getDate() + 1);\n            if (!isNonWorkingDay(endDate)) {\n                remainingDays--;\n            }\n        }\n        \n        return endDate.toISOString().split('T')[0];\n    };\n\n    // Calculate working days needed per asset for detailed timeline alerts\n    const calculateWorkingDaysNeededPerAsset = () => {\n        if (!globalLiveDate || timelineTasks.length === 0) return [];\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        \n        const assetAlerts = [];\n        \n        // Calculate for each asset that has date errors\n        selectedAssets.forEach(asset => {\n            const calculatedStart = calculatedStartDates[asset.id];\n            if (calculatedStart && dateErrors.includes(asset.id)) {\n                const startDate = new Date(calculatedStart);\n                const daysInPast = calculateWorkingDaysBetween(startDate, today);\n                \n                if (daysInPast > 0) {\n                    assetAlerts.push({\n                        assetId: asset.id,\n                        assetName: asset.name,\n                        assetType: asset.type,\n                        daysNeeded: daysInPast,\n                        daysSaved: 0, // This would need to be calculated based on original vs current durations\n                        startDate: calculatedStart,\n                        isCritical: daysInPast > 5 // Mark as critical if more than 5 days needed\n                    });\n                }\n            }\n        });\n        \n        // Sort by urgency (most days needed first)\n        return assetAlerts.sort((a, b) => b.daysNeeded - a.daysNeeded);\n    };\n\n    // Single source of truth for working days needed (same as AssetSelector's getWorkingDaysToSave)\n    const calculateWorkingDaysNeeded = () => {\n        if (!globalLiveDate || timelineTasks.length === 0) return null;\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        \n        // Use the exact same logic as AssetSelector's getWorkingDaysToSave\n        let totalDaysInPast = 0;\n        \n        // Only count assets that are in dateErrors (same as asset-specific calculation)\n        selectedAssets.forEach(asset => {\n            const calculatedStart = calculatedStartDates[asset.id];\n            if (calculatedStart && dateErrors.includes(asset.id)) {\n                const startDate = new Date(calculatedStart);\n                totalDaysInPast += calculateWorkingDaysBetween(startDate, today);\n            }\n        });\n        \n        // Also check custom tasks that start in the past\n        timelineTasks.forEach(task => {\n            if (task.isCustom) {\n                const taskStart = new Date(task.start);\n                if (taskStart < today) {\n                    totalDaysInPast += calculateWorkingDaysBetween(taskStart, today);\n                }\n            }\n        });\n        \n        return {\n            available: 0, // Not used in this calculation\n            allocated: 0, // Not used in this calculation\n            needed: totalDaysInPast\n        };\n    };\n\n\n\n    return (\n        <div className=\"bg-gray-100 min-h-screen font-sans\">\n            <header className=\"bg-white shadow-md\">\n                <div className=\"container mx-auto px-6 py-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <h1 className=\"text-3xl font-bold text-gray-800\">Accordion Timeline Builder</h1>\n                        <div className=\"flex items-center space-x-2\">\n                            <button\n                                onClick={undo}\n                                disabled={historyIndex <= 0}\n                                className=\"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n                                title=\"Undo (Ctrl+Z)\"\n                            >\n                                ↩️ Undo\n                            </button>\n                            <button\n                                onClick={redo}\n                                disabled={historyIndex >= history.length - 1}\n                                className=\"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n                                title=\"Redo (Ctrl+Y)\"\n                            >\n                                ↪️ Redo\n                            </button>\n                        </div>\n                    </div>\n                    {/* Info Box: How to Use This Timeline Builder (moved here, dismissible) */}\n                    {showInfoBox && (\n                        <div className=\"relative mb-6 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-900\">\n                            <button\n                                className=\"absolute top-2 right-2 text-blue-700 hover:text-blue-900 text-lg font-bold focus:outline-none\"\n                                onClick={() => {\n                                    executeAction(() => setShowInfoBox(false), \"Hide instructions\");\n                                }}\n                                aria-label=\"Close instructions\"\n                            >\n                                ×\n                            </button>\n                            <strong>How to Build Your Campaign Timeline:</strong>\n                            <ol className=\"list-decimal pl-5 mt-2 space-y-1\">\n                                <li>\n                                    <strong>Choose Your Campaign Start Date:</strong><br />\n                                    If all assets launch on the same day, set a global start date and check “Use same live date for all assets.”<br />\n                                    If assets launch on different days, uncheck the box and set dates individually for each asset.\n                                </li>\n                                <li>\n                                    <strong>Add Assets:</strong><br />\n                                    Click “Add” next to each asset type you need.<br />\n                                    Need the same asset type more than once? Click “Add” again and give each a unique name.\n                                </li>\n                                <li>\n                                    <strong>Customize Assets:</strong><br />\n                                    Rename each asset for clarity (e.g., “Metro Advertorial – August”).<br />\n                                    Set or confirm the start date for each asset.\n                                </li>\n                                <li>\n                                    <strong>Review Your Timeline:</strong><br />\n                                    Remove any asset you don’t need.<br />\n                                    Check the timeline to ensure all assets are scheduled as planned.\n                                </li>\n                                <li>\n                                    <strong>Adjust Your Timeline if Needed:</strong><br />\n                                    If an asset’s timeline can’t be completed by the selected start date, you’ll see a warning.<br />\n                                    – You can either change the go-live date, or<br />\n                                    – Manually shorten the durations of individual tasks (“accordion” your timeline) until the schedule fits.\n                                </li>\n                                <li>\n                                    <strong>Undo/Redo:</strong><br />\n                                    Use Ctrl+Z to undo and Ctrl+Y to redo any changes you make.<br />\n                                    You can also use the Undo/Redo buttons in the top-right corner.\n                                </li>\n                            </ol>\n                        </div>\n                    )}\n                </div>\n            </header>\n            <main className=\"container mx-auto p-6\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                    {/* LEFT COLUMN: CONTROLS */}\n                    <div\n  className=\"lg:col-span-1 bg-white p-6 rounded-xl shadow-lg overflow-x-auto\"\n  style={{ minWidth: 380 }} // You can adjust 380 to your needs\n>\n                        <h2 className=\"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\">Timeline Setup</h2>\n                        <CampaignSetup \n                            globalLiveDate={globalLiveDate}\n                            onGlobalLiveDateChange={(date) => {\n                                executeAction(() => setGlobalLiveDate(date), `Change global go-live date to ${date}`);\n                            }}\n                            useGlobalDate={useGlobalDate}\n                            onUseGlobalDateChange={(useGlobal) => {\n                                executeAction(() => setUseGlobalDate(useGlobal), `Switch to ${useGlobal ? 'global' : 'individual'} date mode`);\n                            }}\n                            projectStartDate={projectStartDate}\n                            dateErrors={dateErrors}\n                            workingDaysNeeded={calculateWorkingDaysNeeded()}\n                        />\n<AssetSelector\n    assets={uniqueAssets || []}\n    selectedAssets={selectedAssets || []}\n    onAddAsset={handleAddAsset}\n    onRemoveAsset={handleRemoveAsset}\n    useGlobalDate={useGlobalDate}\n    globalLiveDate={globalLiveDate || ''}\n    assetLiveDates={assetLiveDates || {}}\n    onAssetLiveDateChange={handleAssetLiveDateChange}\n    calculatedStartDates={calculatedStartDates || {}}\n    dateErrors={dateErrors || []}\n    onRenameAsset={handleRenameAsset}\n    onAssetStartDateChange={handleAssetStartDateChange}\n    csvData={csvData}\n    onSaveTaskDurations={handleSaveTaskDurations}\n    isNonWorkingDay={isNonWorkingDay}\n    calculateWorkingDaysBetween={calculateWorkingDaysBetween}\n/>\n                    </div>\n                    \n                    {/* RIGHT COLUMN: TIMELINE */}\n                    <div\n  className=\"lg:col-span-2 bg-white p-6 rounded-xl shadow-lg\"\n  style={{ minWidth: 0, maxWidth: \"100%\" }}\n>\n                        <h2 className=\"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\">Generated Timeline</h2>\n                        \n                     {/* Error Messages - Temporarily Disabled */}\n{/* {dateErrors.length > 0 && (\n    <div className=\"mb-4 p-4 bg-red-50 border border-red-200 rounded-md\">\n        <h3 className=\"text-red-800 font-medium mb-2\">⚠️ Timeline Conflicts</h3>\n        <p className=\"text-red-700 text-sm mb-2\">\n            The following assets cannot be completed by their live dates:\n        </p>\n        <ul className=\"text-red-700 text-sm\">\n            {dateErrors.map(asset => (\n                <li key={asset} className=\"ml-4\">\n                    • {asset} (would need to start on {calculatedStartDates[asset]})\n                </li>\n            ))}\n        </ul>\n        <p className=\"text-red-700 text-sm mt-2 font-medium\">\n            Manual adjustment of task durations required.\n        </p>\n    </div>\n)} */}\n\n                        {timelineTasks && timelineTasks.length > 0 ? (\n                                                    <GanttChart \n                            tasks={timelineTasks}\n                            bankHolidays={bankHolidays}\n                            onTaskDurationChange={handleTaskDurationChange}\n                            onTaskNameChange={handleRenameTask}\n                            workingDaysNeeded={calculateWorkingDaysNeeded()}\n                            assetAlerts={calculateWorkingDaysNeededPerAsset()}\n                            onAddCustomTask={handleAddCustomTask}\n                        />\n                        ) : (\n                            <div className=\"text-center text-gray-500 py-10\">\n                                <p className=\"text-lg\">Your timeline will appear here.</p>\n                                <p className=\"text-sm\">Set a live date and select some assets to begin.</p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </main>\n        </div>\n    );\n};\n\nexport default TimelineBuilder;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
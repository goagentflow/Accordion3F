{"ast":null,"code":"var _jsxFileName = \"/Users/hamishnicklin/Accordion3F/src/TimelineBuilder.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport Papa from 'papaparse';\nimport AssetSelector from './components/AssetSelector';\nimport CampaignSetup from './components/CampaignSetup';\nimport GanttChart from './components/GanttChart';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TimelineBuilder = () => {\n  _s();\n  // CSV and asset data\n  const [csvData, setCsvData] = useState([]);\n  const [uniqueAssets, setUniqueAssets] = useState([]);\n  // Each selected asset is now an object with a unique id, type, name, and startDate\n  const [selectedAssets, setSelectedAssets] = useState([]);\n\n  // Live date management\n  const [globalLiveDate, setGlobalLiveDate] = useState('');\n  const [useGlobalDate, setUseGlobalDate] = useState(true);\n  const [assetLiveDates, setAssetLiveDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n\n  // Calculated results\n  const [calculatedStartDates, setCalculatedStartDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n  const [projectStartDate, setProjectStartDate] = useState(''); // Earliest start date across all assets\n  const [dateErrors, setDateErrors] = useState([]); // Array of asset names that start before today\n\n  // Final timeline for display\n  const [timelineTasks, setTimelineTasks] = useState([]);\n  const [showInfoBox, setShowInfoBox] = useState(true); // Add state for info box\n\n  // Add state to store custom task durations for each asset instance\n  const [assetTaskDurations, setAssetTaskDurations] = useState({}); // { assetId: { taskName: duration, ... } }\n\n  // Add state to store custom tasks separately\n  const [customTasks, setCustomTasks] = useState([]); // Array of custom task objects\n\n  // Add state to store custom task names\n  const [customTaskNames, setCustomTaskNames] = useState({}); // { taskId: customName }\n\n  // Add state to store bank holidays\n  const [bankHolidays, setBankHolidays] = useState([]); // Array of YYYY-MM-DD strings\n\n  // Undo/Redo infrastructure\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [isUndoRedoAction, setIsUndoRedoAction] = useState(false);\n\n  // Helper function to get task name (custom or default)\n  const getTaskName = (taskId, assetName, taskInfo) => {\n    // Check if there's a custom name for this task\n    if (customTaskNames[taskId]) {\n      return customTaskNames[taskId];\n    }\n    // Return default format\n    return `${assetName}: ${taskInfo['Task']}`;\n  };\n\n  // Create a snapshot of the current app state for undo/redo\n  const createStateSnapshot = actionDescription => ({\n    // Asset state\n    selectedAssets: JSON.parse(JSON.stringify(selectedAssets)),\n    assetLiveDates: JSON.parse(JSON.stringify(assetLiveDates)),\n    useGlobalDate,\n    globalLiveDate,\n    // Task state\n    customTaskNames: JSON.parse(JSON.stringify(customTaskNames)),\n    assetTaskDurations: JSON.parse(JSON.stringify(assetTaskDurations)),\n    customTasks: JSON.parse(JSON.stringify(customTasks)),\n    // UI state\n    showInfoBox,\n    // Calculated state (will be recalculated after restoration)\n    timelineTasks: JSON.parse(JSON.stringify(timelineTasks)),\n    calculatedStartDates: JSON.parse(JSON.stringify(calculatedStartDates)),\n    dateErrors: JSON.parse(JSON.stringify(dateErrors)),\n    projectStartDate,\n    // Metadata\n    timestamp: Date.now(),\n    actionDescription,\n    actionType: 'user_action'\n  });\n\n  // Restore app state from a snapshot\n  const restoreFromSnapshot = snapshot => {\n    // Restore all state from snapshot\n    setSelectedAssets(snapshot.selectedAssets);\n    setAssetLiveDates(snapshot.assetLiveDates);\n    setUseGlobalDate(snapshot.useGlobalDate);\n    setGlobalLiveDate(snapshot.globalLiveDate);\n    setCustomTaskNames(snapshot.customTaskNames);\n    setAssetTaskDurations(snapshot.assetTaskDurations);\n    setCustomTasks(snapshot.customTasks);\n    setShowInfoBox(snapshot.showInfoBox);\n\n    // Restore calculated state\n    setTimelineTasks(snapshot.timelineTasks);\n    setCalculatedStartDates(snapshot.calculatedStartDates);\n    setDateErrors(snapshot.dateErrors);\n    setProjectStartDate(snapshot.projectStartDate);\n  };\n\n  // Undo function\n  const undo = () => {\n    if (historyIndex > 0) {\n      setIsUndoRedoAction(true);\n      const previousSnapshot = history[historyIndex - 1];\n      restoreFromSnapshot(previousSnapshot);\n      setHistoryIndex(prev => prev - 1);\n      setIsUndoRedoAction(false);\n    }\n  };\n\n  // Redo function\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      setIsUndoRedoAction(true);\n      const nextSnapshot = history[historyIndex + 1];\n      restoreFromSnapshot(nextSnapshot);\n      setHistoryIndex(prev => prev + 1);\n      setIsUndoRedoAction(false);\n    }\n  };\n\n  // Execute an action and save to history\n  const executeAction = (actionFunction, actionDescription) => {\n    // Save current state before action\n    const currentSnapshot = createStateSnapshot(actionDescription);\n\n    // Execute the action\n    actionFunction();\n\n    // Add to history (unless this is an undo/redo action)\n    if (!isUndoRedoAction) {\n      setHistory(prev => {\n        const newHistory = [...prev.slice(0, historyIndex + 1), currentSnapshot];\n        // Limit history to last 50 actions to prevent memory issues\n        return newHistory.slice(-50);\n      });\n      setHistoryIndex(prev => Math.min(prev + 1, 49));\n    }\n  };\n\n  // Helper function to check if date is a non-working day (weekend or bank holiday)\n  const isNonWorkingDay = date => {\n    const day = date.getDay();\n    const yyyy_mm_dd = date.toISOString().split('T')[0];\n    return day === 0 || day === 6 || bankHolidays.includes(yyyy_mm_dd);\n  };\n\n  // Helper function to get previous working day\n  const getPreviousWorkingDay = date => {\n    let workingDate = new Date(date);\n    do {\n      workingDate.setDate(workingDate.getDate() - 1);\n    } while (isNonWorkingDay(workingDate));\n    return workingDate;\n  };\n\n  // Helper function to get next working day\n  const getNextWorkingDay = date => {\n    let workingDate = new Date(date);\n    do {\n      workingDate.setDate(workingDate.getDate() + 1);\n    } while (isNonWorkingDay(workingDate));\n    return workingDate;\n  };\n\n  // Helper function to subtract working days (backwards calculation)\n  const subtractWorkingDays = (endDate, workingDaysToSubtract) => {\n    let currentDate = new Date(endDate);\n    let remainingDays = workingDaysToSubtract;\n    // Subtract working days\n    while (remainingDays > 0) {\n      currentDate.setDate(currentDate.getDate() - 1);\n      // Only count non-non-working days\n      if (!isNonWorkingDay(currentDate)) {\n        remainingDays--;\n      }\n    }\n    return currentDate;\n  };\n\n  // Helper function to add working days (forward calculation for display)\n  const addWorkingDays = (startDate, workingDaysToAdd) => {\n    if (workingDaysToAdd <= 0) {\n      return new Date(startDate);\n    }\n    let currentDate = new Date(startDate);\n    let remainingDays = workingDaysToAdd - 1;\n    while (remainingDays > 0) {\n      currentDate.setDate(currentDate.getDate() + 1);\n      if (!isNonWorkingDay(currentDate)) {\n        remainingDays--;\n      }\n    }\n    // Ensure the final day is a working day\n    while (isNonWorkingDay(currentDate)) {\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n    return currentDate;\n  };\n\n  // Load CSV data\n  useEffect(() => {\n    Papa.parse(`${window.location.origin}/Group_Asset_Task_Time.csv`, {\n      download: true,\n      header: true,\n      skipEmptyLines: true,\n      complete: results => {\n        const parsedData = results.data;\n        setCsvData(parsedData);\n\n        // Extract unique asset types from CSV\n        const assetTypes = [...new Set(parsedData.map(row => row['Asset Type']))].filter(type => type);\n        setUniqueAssets(assetTypes);\n      },\n      error: error => {\n        console.error(\"Error parsing CSV file:\", error);\n      }\n    });\n  }, []);\n\n  // Fetch UK bank holidays for England and Wales on app load\n  useEffect(() => {\n    fetch('https://www.gov.uk/bank-holidays.json').then(response => response.json()).then(data => {\n      // Get all dates for England and Wales\n      const events = data['england-and-wales'].events;\n      // Get all dates for the next 10 years\n      const now = new Date();\n      const tenYearsFromNow = new Date(now.getFullYear() + 10, now.getMonth(), now.getDate());\n      const holidayDates = events.map(event => event.date).filter(dateStr => {\n        const date = new Date(dateStr);\n        return date >= now && date <= tenYearsFromNow;\n      });\n      setBankHolidays(holidayDates);\n    }).catch(err => {\n      // If fetch fails, fallback to an empty array (or you could use a static list)\n      setBankHolidays([]);\n    });\n  }, []);\n\n  // Calculate backwards timeline when live dates or assets change\n  useEffect(() => {\n    if (selectedAssets.length === 0 || csvData.length === 0) {\n      setTimelineTasks([]);\n      setCalculatedStartDates({});\n      setProjectStartDate('');\n      setDateErrors([]);\n      return;\n    }\n    const today = new Date();\n    today.setHours(0, 0, 0, 0); // Reset time for accurate comparison\n\n    const newCalculatedStartDates = {};\n    const newDateErrors = [];\n    const allStartDates = [];\n    const allTasks = [];\n\n    // Loop over each selected asset instance (not just type)\n    selectedAssets.forEach(asset => {\n      // asset: { id, type, name, startDate }\n      if (!asset.startDate) return; // Skip if no start date set\n\n      // Find all tasks for this asset type from the CSV\n      const assetTasks = csvData.filter(row => row['Asset Type'] === asset.type);\n      if (assetTasks.length === 0) return;\n\n      // Use the asset instance's startDate as the go-live date\n      const liveDate = new Date(asset.startDate);\n      if (isNaN(liveDate.getTime())) return;\n\n      // We'll build the tasks in reverse (from go-live backwards)\n      let currentEndDate = new Date(liveDate);\n      const ganttTasks = [];\n      let taskIndex = 0;\n\n      // Go-live task (single day)\n      const goLiveTaskId = `${asset.id}-go-live`;\n      ganttTasks.unshift({\n        id: goLiveTaskId,\n        name: getTaskName(goLiveTaskId, asset.name, {\n          'Task': 'Go-Live'\n        }),\n        start: liveDate.toISOString().split('T')[0],\n        end: liveDate.toISOString().split('T')[0],\n        progress: 0\n      });\n      taskIndex++;\n\n      // Process all other tasks in reverse order\n      for (let i = assetTasks.length - 1; i >= 0; i--) {\n        const taskInfo = assetTasks[i];\n        // Use custom duration if present, else default from CSV\n        const customDurations = assetTaskDurations[asset.id] || {};\n        const duration = customDurations[taskInfo['Task']] !== undefined ? customDurations[taskInfo['Task']] : parseInt(taskInfo['Duration (Days)'], 10) || 1;\n        // Subtract working days to get the start date\n        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n        // Task ends the working day before currentEndDate\n        const taskEndDate = new Date(currentEndDate);\n        taskEndDate.setDate(taskEndDate.getDate() - 1);\n        // Ensure end date is a working day\n        let finalTaskEndDate = new Date(taskEndDate);\n        if (isNonWorkingDay(finalTaskEndDate)) {\n          finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n        }\n        const taskId = `${asset.id}-task-${taskIndex}`;\n        ganttTasks.unshift({\n          id: taskId,\n          name: getTaskName(taskId, asset.name, taskInfo),\n          start: taskStartDate.toISOString().split('T')[0],\n          end: finalTaskEndDate.toISOString().split('T')[0],\n          progress: 0\n        });\n        taskIndex++;\n        // Update currentEndDate for the next task\n        currentEndDate = new Date(taskStartDate);\n      }\n\n      // Add all tasks for this asset instance to the main list\n      allTasks.push(...ganttTasks);\n\n      // Set the calculated start date for this asset to the start date of the first (earliest) task\n      if (ganttTasks.length > 0 && ganttTasks[0].start) {\n        newCalculatedStartDates[asset.id] = ganttTasks[0].start;\n        allStartDates.push(new Date(ganttTasks[0].start));\n      }\n\n      // Check if start date is before today\n      if (ganttTasks.length > 0 && new Date(ganttTasks[0].start) < today) {\n        newDateErrors.push(asset.id);\n      }\n    });\n\n    // Find earliest start date across all assets\n    if (allStartDates.length > 0) {\n      const earliestDate = new Date(Math.min(...allStartDates));\n      setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n    }\n\n    // Integrate custom tasks into the main timeline calculation\n    const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n    if (currentCustomTasks.length > 0) {\n      setCustomTasks(currentCustomTasks);\n\n      // Create a unified timeline that includes both asset tasks and custom tasks\n      const unifiedTimeline = [...allTasks];\n\n      // Sort custom tasks by their original insertion order\n      const sortedCustomTasks = [...currentCustomTasks].sort((a, b) => {\n        const aIndex = timelineTasks.findIndex(task => task.id === a.id);\n        const bIndex = timelineTasks.findIndex(task => task.id === b.id);\n        return aIndex - bIndex;\n      });\n\n      // Insert custom tasks at their correct positions in the unified timeline\n      sortedCustomTasks.forEach(customTask => {\n        let insertIndex = 0;\n        if (customTask.insertAfterTaskId) {\n          const afterTaskIndex = unifiedTimeline.findIndex(task => task.id === customTask.insertAfterTaskId);\n          if (afterTaskIndex !== -1) {\n            insertIndex = afterTaskIndex + 1;\n          }\n        }\n\n        // Calculate the custom task dates based on the current unified timeline\n        let newTaskStartDate;\n        if (insertIndex === 0) {\n          // Insert at the beginning\n          newTaskStartDate = new Date(projectStartDate);\n        } else {\n          // Insert after another task\n          const previousTask = unifiedTimeline[insertIndex - 1];\n          const previousTaskEnd = new Date(previousTask.end);\n          newTaskStartDate = new Date(previousTaskEnd);\n          newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n\n          // Ensure the start date is a working day\n          while (isNonWorkingDay(newTaskStartDate)) {\n            newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n          }\n        }\n\n        // Calculate the end date based on duration (inclusive)\n        let newTaskEndDate = new Date(newTaskStartDate);\n        let newTaskRemainingDays = customTask.duration - 1;\n        while (newTaskRemainingDays > 0) {\n          newTaskEndDate.setDate(newTaskEndDate.getDate() + 1);\n          if (!isNonWorkingDay(newTaskEndDate)) {\n            newTaskRemainingDays--;\n          }\n        }\n\n        // Create the custom task with recalculated dates\n        const newCustomTask = {\n          ...customTask,\n          id: customTask.id,\n          name: customTask.name,\n          duration: customTask.duration,\n          start: newTaskStartDate.toISOString().split('T')[0],\n          end: newTaskEndDate.toISOString().split('T')[0],\n          isCustom: true\n        };\n\n        // Insert the custom task into the unified timeline\n        unifiedTimeline.splice(insertIndex, 0, newCustomTask);\n      });\n\n      // After inserting custom tasks, rebuild the timeline backwards from go-live\n      // This preserves the fixed go-live date and respects manual duration overrides\n      const finalTimeline = [];\n\n      // Group tasks by asset to maintain the backwards calculation\n      const tasksByAsset = {};\n      unifiedTimeline.forEach(task => {\n        if (task.isCustom) {\n          // Custom tasks will be inserted at their specified positions\n          if (!tasksByAsset.custom) tasksByAsset.custom = [];\n          tasksByAsset.custom.push(task);\n        } else {\n          // Asset tasks are grouped by their asset ID\n          const assetId = task.id.split('-')[0];\n          if (!tasksByAsset[assetId]) tasksByAsset[assetId] = [];\n          tasksByAsset[assetId].push(task);\n        }\n      });\n\n      // Rebuild each asset's timeline backwards from go-live\n      selectedAssets.forEach(asset => {\n        const assetTasks = tasksByAsset[asset.id] || [];\n        if (assetTasks.length === 0) return;\n\n        // Separate go-live task from other tasks\n        const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n        const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n\n        // Build backwards from go-live to calculate dates\n        let currentEndDate = new Date(asset.startDate);\n        const calculatedTasks = [];\n\n        // Calculate dates for regular tasks in reverse order (backwards from go-live)\n        for (let i = regularTasks.length - 1; i >= 0; i--) {\n          const task = regularTasks[i];\n          const taskInfo = csvData.find(row => row['Asset Type'] === asset.type && row['Task'] === task.name.split(': ')[1]);\n\n          // Use manual duration override if available\n          const customDurations = assetTaskDurations[asset.id] || {};\n          const duration = customDurations[taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Task']] !== undefined ? customDurations[taskInfo['Task']] : parseInt(taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Duration (Days)'], 10) || 1;\n          const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n          const taskEndDate = new Date(currentEndDate);\n          taskEndDate.setDate(taskEndDate.getDate() - 1);\n\n          // Ensure end date is a working day\n          let finalTaskEndDate = new Date(taskEndDate);\n          if (isNonWorkingDay(finalTaskEndDate)) {\n            finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n          }\n          calculatedTasks.unshift({\n            ...task,\n            start: taskStartDate.toISOString().split('T')[0],\n            end: finalTaskEndDate.toISOString().split('T')[0]\n          });\n          currentEndDate = new Date(taskStartDate);\n        }\n\n        // Add go-live task at the end\n        if (goLiveTask) {\n          calculatedTasks.push({\n            ...goLiveTask,\n            start: asset.startDate,\n            end: asset.startDate\n          });\n        }\n\n        // Add all tasks to final timeline in correct order\n        finalTimeline.push(...calculatedTasks);\n      });\n\n      // Now rebuild the entire timeline sequentially including custom tasks\n      const allTasksSequential = [];\n\n      // First, collect all tasks (asset tasks + custom tasks) in the correct order\n      selectedAssets.forEach(asset => {\n        const assetTasks = tasksByAsset[asset.id] || [];\n        const customTasksForAsset = customTasks.filter(ct => {\n          // Find which asset this custom task belongs to based on insertAfterTaskId\n          if (ct.insertAfterTaskId) {\n            const afterTask = assetTasks.find(task => task.id === ct.insertAfterTaskId);\n            return afterTask !== undefined;\n          }\n          return false;\n        });\n\n        // Separate go-live task from regular tasks\n        const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n        const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n\n        // Create ordered task list for this asset\n        const orderedTasks = [];\n\n        // Add regular tasks in their original order\n        regularTasks.forEach((task, index) => {\n          orderedTasks.push(task);\n\n          // Insert custom tasks that should go after this task\n          const customTasksAfterThis = customTasksForAsset.filter(ct => ct.insertAfterTaskId === task.id);\n          orderedTasks.push(...customTasksAfterThis);\n        });\n\n        // Add go-live task at the end\n        if (goLiveTask) {\n          orderedTasks.push(goLiveTask);\n        }\n\n        // Now build the timeline backwards from go-live for this asset\n        let currentEndDate = new Date(asset.startDate);\n        const assetTimeline = [];\n\n        // Process tasks in reverse order (backwards from go-live)\n        for (let i = orderedTasks.length - 1; i >= 0; i--) {\n          const task = orderedTasks[i];\n          if (task.isCustom) {\n            // Custom task - calculate backwards\n            const taskStartDate = subtractWorkingDays(currentEndDate, task.duration);\n            const taskEndDate = new Date(currentEndDate);\n            taskEndDate.setDate(taskEndDate.getDate() - 1);\n\n            // Ensure end date is a working day\n            let finalTaskEndDate = new Date(taskEndDate);\n            if (isNonWorkingDay(finalTaskEndDate)) {\n              finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n            }\n            assetTimeline.unshift({\n              ...task,\n              start: taskStartDate.toISOString().split('T')[0],\n              end: finalTaskEndDate.toISOString().split('T')[0]\n            });\n            currentEndDate = new Date(taskStartDate);\n          } else if (task.name.includes('Go-Live')) {\n            // Go-live task\n            assetTimeline.unshift({\n              ...task,\n              start: currentEndDate.toISOString().split('T')[0],\n              end: currentEndDate.toISOString().split('T')[0]\n            });\n          } else {\n            // Regular asset task - calculate backwards\n            const taskInfo = csvData.find(row => row['Asset Type'] === asset.type && row['Task'] === task.name.split(': ')[1]);\n\n            // Use manual duration override if available\n            const customDurations = assetTaskDurations[asset.id] || {};\n            const duration = customDurations[taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Task']] !== undefined ? customDurations[taskInfo['Task']] : parseInt(taskInfo === null || taskInfo === void 0 ? void 0 : taskInfo['Duration (Days)'], 10) || 1;\n            const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n            const taskEndDate = new Date(currentEndDate);\n            taskEndDate.setDate(taskEndDate.getDate() - 1);\n\n            // Ensure end date is a working day\n            let finalTaskEndDate = new Date(taskEndDate);\n            if (isNonWorkingDay(finalTaskEndDate)) {\n              finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n            }\n            assetTimeline.unshift({\n              ...task,\n              start: taskStartDate.toISOString().split('T')[0],\n              end: finalTaskEndDate.toISOString().split('T')[0]\n            });\n            currentEndDate = new Date(taskStartDate);\n          }\n        }\n\n        // Add this asset's timeline to the main timeline\n        allTasksSequential.push(...assetTimeline);\n      });\n\n      // Update the final timeline\n      finalTimeline.length = 0;\n      finalTimeline.push(...allTasksSequential);\n      setTimelineTasks(finalTimeline);\n\n      // Recalculate dateErrors based on the final timeline\n      const finalDateErrors = [];\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      selectedAssets.forEach(asset => {\n        const assetTasks = finalTimeline.filter(task => task.id.startsWith(`${asset.id}-`) && !task.name.includes('Go-Live'));\n        if (assetTasks.length > 0) {\n          // Find the earliest task for this asset\n          const earliestTask = assetTasks.reduce((earliest, task) => {\n            return new Date(task.start) < new Date(earliest.start) ? task : earliest;\n          });\n\n          // Update calculated start date\n          newCalculatedStartDates[asset.id] = earliestTask.start;\n\n          // Check if start date is before today\n          if (new Date(earliestTask.start) < today) {\n            finalDateErrors.push(asset.id);\n          }\n        }\n      });\n      setCalculatedStartDates(newCalculatedStartDates);\n      setDateErrors(finalDateErrors);\n    } else {\n      setTimelineTasks(allTasks);\n      setCalculatedStartDates(newCalculatedStartDates);\n      setDateErrors(newDateErrors);\n    }\n  }, [selectedAssets, globalLiveDate, useGlobalDate, assetLiveDates, csvData, assetTaskDurations, customTaskNames]);\n\n  // Keyboard shortcuts for undo/redo\n  useEffect(() => {\n    const handleKeyDown = e => {\n      if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n        e.preventDefault();\n        undo();\n      }\n      if ((e.ctrlKey || e.metaKey) && e.key === 'y' || (e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z') {\n        e.preventDefault();\n        redo();\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [historyIndex, history.length]);\n  // This new useEffect pre-populates individual dates when switching from global mode\n  useEffect(() => {\n    if (!useGlobalDate && globalLiveDate && selectedAssets.length > 0) {\n      const newLiveDates = {\n        ...assetLiveDates\n      };\n      let updated = false;\n      selectedAssets.forEach(asset => {\n        // Pre-fill only if the asset doesn't have an individual date set\n        if (!newLiveDates[asset.name]) {\n          // Changed to asset.name\n          newLiveDates[asset.name] = globalLiveDate; // Changed to asset.name\n          updated = true;\n        }\n      });\n      if (updated) {\n        setAssetLiveDates(newLiveDates);\n      }\n    }\n  }, [useGlobalDate, globalLiveDate, selectedAssets, assetLiveDates]);\n\n  // Sync all asset instance startDates to globalLiveDate if useGlobalDate is true\n  useEffect(() => {\n    if (useGlobalDate && globalLiveDate && !isUndoRedoAction) {\n      setSelectedAssets(prev => prev.map(asset => asset.startDate !== globalLiveDate ? {\n        ...asset,\n        startDate: globalLiveDate\n      } : asset));\n    }\n    // Optionally, if unchecked, you could clear the dates or leave as-is\n  }, [useGlobalDate, globalLiveDate]);\n\n  // Preserve custom tasks whenever timelineTasks changes\n  useEffect(() => {\n    const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n    if (currentCustomTasks.length > 0) {\n      setCustomTasks(currentCustomTasks);\n    }\n  }, [timelineTasks]);\n\n  // REMOVED: Separate custom task merging useEffect\n  // Custom tasks are now integrated directly into the main timeline calculation\n\n  // REMOVED: Custom task merging useEffect that was causing timeline disruption\n  // Custom tasks are now handled properly in the main timeline calculation\n  // Generate timeline tasks for Gantt chart\n  const generateTimelineTasks = startDates => {\n    if (selectedAssets.length === 0 || Object.keys(startDates).length === 0) {\n      setTimelineTasks([]);\n      return;\n    }\n    const allTasks = [];\n    let taskIndex = 0;\n    selectedAssets.forEach(asset => {\n      const assetName = asset.name; // Assuming asset object has a 'name' property\n      const assetTasks = csvData.filter(row => row['Asset Type'] === assetName);\n      if (assetTasks.length === 0) return;\n\n      // Get the correct live date for this asset\n      const liveDate = new Date(useGlobalDate ? globalLiveDate : assetLiveDates[assetName]);\n      if (isNaN(liveDate.getTime())) return;\n\n      // We'll build the tasks in reverse (from go-live backwards)\n      let currentEndDate = new Date(liveDate);\n      const ganttTasks = [];\n      let taskIndex = 0;\n\n      // Go-live task (single day)\n      ganttTasks.unshift({\n        id: `task-${taskIndex}`,\n        name: `${assetName}: Go-Live`,\n        start: liveDate.toISOString().split('T')[0],\n        end: liveDate.toISOString().split('T')[0],\n        progress: 0\n      });\n      taskIndex++;\n\n      // Process all other tasks in reverse order\n      for (let i = assetTasks.length - 1; i >= 0; i--) {\n        const taskInfo = assetTasks[i];\n        const duration = parseInt(taskInfo['Duration (Days)'], 10) || 1;\n        // Subtract working days to get the start date\n        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n        // Task ends the working day before currentEndDate\n        const taskEndDate = new Date(currentEndDate);\n        taskEndDate.setDate(taskEndDate.getDate() - 1);\n        // Ensure end date is a working day\n        let finalTaskEndDate = new Date(taskEndDate);\n        if (isNonWorkingDay(finalTaskEndDate)) {\n          finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n        }\n        ganttTasks.unshift({\n          id: `task-${taskIndex}`,\n          name: `${taskInfo['Asset Type']}: ${taskInfo['Task']}`,\n          start: taskStartDate.toISOString().split('T')[0],\n          end: finalTaskEndDate.toISOString().split('T')[0],\n          progress: 0\n        });\n        taskIndex++;\n        // Update currentEndDate for the next task\n        currentEndDate = new Date(taskStartDate);\n      }\n\n      // Add all tasks for this asset to the main list\n      allTasks.push(...ganttTasks);\n\n      // Set the calculated start date for this asset to the start date of the first (earliest) task\n      if (ganttTasks.length > 0 && ganttTasks[0].start) {\n        newCalculatedStartDates[assetName] = ganttTasks[0].start;\n      }\n    });\n\n    // Merge custom tasks back into the timeline\n    if (customTasks.length > 0) {\n      // Insert custom tasks at their specified positions\n      customTasks.forEach(customTask => {\n        let insertIndex = 0;\n        if (customTask.insertAfterTaskId) {\n          const afterTaskIndex = allTasks.findIndex(task => task.id === customTask.insertAfterTaskId);\n          if (afterTaskIndex !== -1) {\n            insertIndex = afterTaskIndex + 1;\n          }\n        }\n\n        // Create a new custom task with updated dates\n        const newCustomTask = {\n          ...customTask,\n          id: customTask.id,\n          // Keep the same ID\n          name: customTask.name,\n          duration: customTask.duration,\n          isCustom: true\n        };\n\n        // Insert the custom task\n        allTasks.splice(insertIndex, 0, newCustomTask);\n      });\n\n      // Recalculate all task dates to accommodate custom tasks\n      // This is a simplified version - in practice, you'd want to recalculate dates\n      // based on the new timeline structure\n    }\n    setCalculatedStartDates(newCalculatedStartDates);\n    setTimelineTasks(allTasks);\n  };\n\n  // Helper to generate a unique id (could use a counter or Date.now())\n  const generateAssetId = () => Date.now() + Math.random();\n\n  // Add a new asset instance\n  const handleAddAsset = assetType => {\n    executeAction(() => {\n      const newAsset = {\n        id: generateAssetId(),\n        type: assetType,\n        name: assetType,\n        // default name, can be edited later\n        startDate: useGlobalDate && globalLiveDate ? globalLiveDate : ''\n      };\n      setSelectedAssets(prev => [...prev, newAsset]);\n    }, `Add ${assetType} asset`);\n  };\n\n  // Remove an asset instance by id\n  const handleRemoveAsset = assetId => {\n    const assetToRemove = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.filter(asset => asset.id !== assetId));\n    }, `Remove ${(assetToRemove === null || assetToRemove === void 0 ? void 0 : assetToRemove.name) || 'asset'}`);\n  };\n\n  // Handler to rename an asset instance by id\n  const handleRenameAsset = (assetId, newName) => {\n    const assetToRename = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.map(asset => asset.id === assetId ? {\n        ...asset,\n        name: newName\n      } : asset));\n    }, `Rename asset to \"${newName}\"`);\n  };\n\n  // Handler to rename a task\n  const handleRenameTask = (taskId, newName) => {\n    const currentTask = timelineTasks.find(task => task.id === taskId);\n    executeAction(() => {\n      setCustomTaskNames(prev => ({\n        ...prev,\n        [taskId]: newName\n      }));\n    }, `Rename task to \"${newName}\"`);\n  };\n  const handleAssetLiveDateChange = (assetName, date) => {\n    executeAction(() => {\n      setAssetLiveDates(prev => ({\n        ...prev,\n        [assetName]: date\n      }));\n    }, `Change ${assetName} go-live date to ${date}`);\n  };\n  const handleAssetStartDateChange = (assetId, newDate) => {\n    const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setSelectedAssets(prev => prev.map(asset => asset.id === assetId ? {\n        ...asset,\n        startDate: newDate\n      } : asset));\n    }, `Change ${(assetToUpdate === null || assetToUpdate === void 0 ? void 0 : assetToUpdate.name) || 'asset'} go-live date to ${newDate}`);\n  };\n\n  // Handler to save custom task durations for an asset\n  const handleSaveTaskDurations = (assetId, durations) => {\n    const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n    executeAction(() => {\n      setAssetTaskDurations(prev => ({\n        ...prev,\n        [assetId]: durations\n      }));\n\n      // Preserve custom tasks before timeline recalculation\n      const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n      setCustomTasks(currentCustomTasks);\n    }, `Update task durations for ${(assetToUpdate === null || assetToUpdate === void 0 ? void 0 : assetToUpdate.name) || 'asset'}`);\n  };\n\n  // Handler for drag-to-resize task duration\n  const handleTaskDurationChange = (taskId, newDuration, newEndDate) => {\n    // Find the task being modified\n    const taskIndex = timelineTasks.findIndex(task => task.id === taskId);\n    if (taskIndex === -1) return;\n\n    // Extract asset ID and task name from the task ID\n    const assetId = taskId.split('-task-')[0];\n    const taskName = timelineTasks[taskIndex].name.split(': ')[1]; // Get task name after the colon\n\n    executeAction(() => {\n      // Update the assetTaskDurations state to trigger the same recalculation logic\n      // that the manual duration editing uses\n      setAssetTaskDurations(prev => {\n        const currentDurations = prev[assetId] || {};\n        return {\n          ...prev,\n          [assetId]: {\n            ...currentDurations,\n            [taskName]: newDuration\n          }\n        };\n      });\n    }, `Change ${taskName} duration to ${newDuration} days`);\n  };\n\n  // Handler for adding custom tasks\n  const handleAddCustomTask = customTaskData => {\n    const {\n      name,\n      duration,\n      insertAfterTaskId\n    } = customTaskData;\n    executeAction(() => {\n      // Create the new custom task with calculated dates\n      const newTaskId = `custom-task-${Date.now()}`;\n\n      // Calculate start and end dates for the custom task\n      let newTaskStartDate;\n      if (insertAfterTaskId) {\n        // Insert after a specific task\n        const afterTask = timelineTasks.find(task => task.id === insertAfterTaskId);\n        if (afterTask) {\n          const afterTaskEnd = new Date(afterTask.end);\n          newTaskStartDate = new Date(afterTaskEnd);\n          newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n\n          // Ensure the start date is a working day\n          while (isNonWorkingDay(newTaskStartDate)) {\n            newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n          }\n        } else {\n          // Fallback to project start date\n          newTaskStartDate = new Date(projectStartDate);\n        }\n      } else {\n        // Insert at the beginning\n        newTaskStartDate = new Date(projectStartDate);\n      }\n\n      // Calculate end date based on duration\n      let newTaskEndDate = new Date(newTaskStartDate);\n      let remainingDays = duration - 1; // -1 because we count the start date\n\n      while (remainingDays > 0) {\n        newTaskEndDate.setDate(newTaskEndDate.getDate() + 1);\n        if (!isNonWorkingDay(newTaskEndDate)) {\n          remainingDays--;\n        }\n      }\n      const newTask = {\n        id: newTaskId,\n        name: `Custom: ${name}`,\n        start: newTaskStartDate.toISOString().split('T')[0],\n        end: newTaskEndDate.toISOString().split('T')[0],\n        duration: duration,\n        insertAfterTaskId: insertAfterTaskId,\n        isCustom: true,\n        progress: 0\n      };\n\n      // Add to custom tasks\n      setCustomTasks(prev => [...prev, newTask]);\n\n      // Insert the custom task at the correct position in timeline tasks\n      setTimelineTasks(prev => {\n        const newTimelineTasks = [...prev];\n        let insertIndex = 0;\n        if (insertAfterTaskId) {\n          // Find the position after the specified task\n          const afterTaskIndex = newTimelineTasks.findIndex(task => task.id === insertAfterTaskId);\n          if (afterTaskIndex !== -1) {\n            insertIndex = afterTaskIndex + 1;\n          }\n        }\n\n        // Insert the custom task at the calculated position\n        newTimelineTasks.splice(insertIndex, 0, newTask);\n        return newTimelineTasks;\n      });\n    }, `Add custom task \"${name}\"`);\n  };\n\n  // Helper function to count working days between two dates (exclusive)\n  const countWorkingDays = (startDate, endDate) => {\n    let count = 0;\n    const current = new Date(startDate);\n    const end = new Date(endDate);\n\n    // Move to next day to make it exclusive\n    current.setDate(current.getDate() + 1);\n    while (current <= end) {\n      if (!isNonWorkingDay(current)) {\n        count++;\n      }\n      current.setDate(current.getDate() + 1);\n    }\n    return count;\n  };\n\n  // Single source of truth for working days calculation (same as AssetSelector)\n  const calculateWorkingDaysBetween = (startDate, endDate) => {\n    if (!startDate || !endDate) return 0;\n    const start = new Date(startDate);\n    const end = new Date(endDate);\n    if (start >= end) return 0;\n    let workingDays = 0;\n    let currentDate = new Date(start);\n    while (currentDate < end) {\n      const dayOfWeek = currentDate.getDay();\n      // Count if not weekend (0 = Sunday, 6 = Saturday)\n      if (dayOfWeek !== 0 && dayOfWeek !== 6) {\n        workingDays++;\n      }\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n    return workingDays;\n  };\n\n  // Helper function to calculate task end date based on start date and duration\n  const calculateTaskEndDate = (startDate, duration) => {\n    let endDate = new Date(startDate);\n    let remainingDays = duration - 1; // -1 because we count the start date\n\n    while (remainingDays > 0) {\n      endDate.setDate(endDate.getDate() + 1);\n      if (!isNonWorkingDay(endDate)) {\n        remainingDays--;\n      }\n    }\n    return endDate.toISOString().split('T')[0];\n  };\n\n  // Single source of truth for working days needed (same as AssetSelector's getWorkingDaysToSave)\n  const calculateWorkingDaysNeeded = () => {\n    if (!globalLiveDate || timelineTasks.length === 0) return null;\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // Use the exact same logic as AssetSelector's getWorkingDaysToSave\n    let totalDaysInPast = 0;\n\n    // Only count assets that are in dateErrors (same as asset-specific calculation)\n    selectedAssets.forEach(asset => {\n      const calculatedStart = calculatedStartDates[asset.id];\n      if (calculatedStart && dateErrors.includes(asset.id)) {\n        const startDate = new Date(calculatedStart);\n        totalDaysInPast += calculateWorkingDaysBetween(startDate, today);\n      }\n    });\n\n    // Also check custom tasks that start in the past\n    timelineTasks.forEach(task => {\n      if (task.isCustom) {\n        const taskStart = new Date(task.start);\n        if (taskStart < today) {\n          totalDaysInPast += calculateWorkingDaysBetween(taskStart, today);\n        }\n      }\n    });\n    return {\n      available: 0,\n      // Not used in this calculation\n      allocated: 0,\n      // Not used in this calculation\n      needed: totalDaysInPast\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-gray-100 min-h-screen font-sans\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"bg-white shadow-md\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container mx-auto px-6 py-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"text-3xl font-bold text-gray-800\",\n            children: \"Accordion Timeline Builder\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1087,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center space-x-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: undo,\n              disabled: historyIndex <= 0,\n              className: \"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",\n              title: \"Undo (Ctrl+Z)\",\n              children: \"\\u21A9\\uFE0F Undo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1089,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: redo,\n              disabled: historyIndex >= history.length - 1,\n              className: \"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\",\n              title: \"Redo (Ctrl+Y)\",\n              children: \"\\u21AA\\uFE0F Redo\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1097,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1088,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1086,\n          columnNumber: 21\n        }, this), showInfoBox && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"relative mb-6 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-900\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"absolute top-2 right-2 text-blue-700 hover:text-blue-900 text-lg font-bold focus:outline-none\",\n            onClick: () => {\n              executeAction(() => setShowInfoBox(false), \"Hide instructions\");\n            },\n            \"aria-label\": \"Close instructions\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1110,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"How to Build Your Campaign Timeline:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1119,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"ol\", {\n            className: \"list-decimal pl-5 mt-2 space-y-1\",\n            children: [/*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Choose Your Campaign Start Date:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1122,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1122,\n                columnNumber: 86\n              }, this), \"If all assets launch on the same day, set a global start date and check \\u201CUse same live date for all assets.\\u201D\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1123,\n                columnNumber: 145\n              }, this), \"If assets launch on different days, uncheck the box and set dates individually for each asset.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1121,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Add Assets:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1127,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1127,\n                columnNumber: 65\n              }, this), \"Click \\u201CAdd\\u201D next to each asset type you need.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1128,\n                columnNumber: 82\n              }, this), \"Need the same asset type more than once? Click \\u201CAdd\\u201D again and give each a unique name.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1126,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Customize Assets:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1132,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1132,\n                columnNumber: 71\n              }, this), \"Rename each asset for clarity (e.g., \\u201CMetro Advertorial \\u2013 August\\u201D).\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1133,\n                columnNumber: 104\n              }, this), \"Set or confirm the start date for each asset.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1131,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Review Your Timeline:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1137,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1137,\n                columnNumber: 75\n              }, this), \"Remove any asset you don\\u2019t need.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1138,\n                columnNumber: 69\n              }, this), \"Check the timeline to ensure all assets are scheduled as planned.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1136,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Adjust Your Timeline if Needed:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1142,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1142,\n                columnNumber: 85\n              }, this), \"If an asset\\u2019s timeline can\\u2019t be completed by the selected start date, you\\u2019ll see a warning.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1143,\n                columnNumber: 128\n              }, this), \"\\u2013 You can either change the go-live date, or\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1144,\n                columnNumber: 81\n              }, this), \"\\u2013 Manually shorten the durations of individual tasks (\\u201Caccordion\\u201D your timeline) until the schedule fits.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1141,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Undo/Redo:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1148,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1148,\n                columnNumber: 64\n              }, this), \"Use Ctrl+Z to undo and Ctrl+Y to redo any changes you make.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1149,\n                columnNumber: 96\n              }, this), \"You can also use the Undo/Redo buttons in the top-right corner.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1147,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1120,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1109,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1085,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1084,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"container mx-auto p-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 lg:grid-cols-3 gap-8\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:col-span-1 bg-white p-6 rounded-xl shadow-lg overflow-x-auto\",\n          style: {\n            minWidth: 380\n          } // You can adjust 380 to your needs\n          ,\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\",\n            children: \"Timeline Setup\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1164,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(CampaignSetup, {\n            globalLiveDate: globalLiveDate,\n            onGlobalLiveDateChange: date => {\n              executeAction(() => setGlobalLiveDate(date), `Change global go-live date to ${date}`);\n            },\n            useGlobalDate: useGlobalDate,\n            onUseGlobalDateChange: useGlobal => {\n              executeAction(() => setUseGlobalDate(useGlobal), `Switch to ${useGlobal ? 'global' : 'individual'} date mode`);\n            },\n            projectStartDate: projectStartDate,\n            dateErrors: dateErrors,\n            workingDaysNeeded: calculateWorkingDaysNeeded()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1165,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(AssetSelector, {\n            assets: uniqueAssets || [],\n            selectedAssets: selectedAssets || [],\n            onAddAsset: handleAddAsset,\n            onRemoveAsset: handleRemoveAsset,\n            useGlobalDate: useGlobalDate,\n            globalLiveDate: globalLiveDate || '',\n            assetLiveDates: assetLiveDates || {},\n            onAssetLiveDateChange: handleAssetLiveDateChange,\n            calculatedStartDates: calculatedStartDates || {},\n            dateErrors: dateErrors || [],\n            onRenameAsset: handleRenameAsset,\n            onAssetStartDateChange: handleAssetStartDateChange,\n            csvData: csvData,\n            onSaveTaskDurations: handleSaveTaskDurations,\n            isNonWorkingDay: isNonWorkingDay,\n            calculateWorkingDaysBetween: calculateWorkingDaysBetween\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1178,\n            columnNumber: 1\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1160,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:col-span-2 bg-white p-6 rounded-xl shadow-lg\",\n          style: {\n            minWidth: 0,\n            maxWidth: \"100%\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\",\n            children: \"Generated Timeline\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1203,\n            columnNumber: 25\n          }, this), timelineTasks && timelineTasks.length > 0 ? /*#__PURE__*/_jsxDEV(GanttChart, {\n            tasks: timelineTasks,\n            bankHolidays: bankHolidays,\n            onTaskDurationChange: handleTaskDurationChange,\n            onTaskNameChange: handleRenameTask,\n            workingDaysNeeded: calculateWorkingDaysNeeded(),\n            onAddCustomTask: handleAddCustomTask\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1226,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center text-gray-500 py-10\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-lg\",\n              children: \"Your timeline will appear here.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1236,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-sm\",\n              children: \"Set a live date and select some assets to begin.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1237,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1235,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1199,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1158,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1157,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1083,\n    columnNumber: 9\n  }, this);\n};\n_s(TimelineBuilder, \"EBwDazg7yUx16OZ1GRS3EIVKCoY=\");\n_c = TimelineBuilder;\nexport default TimelineBuilder;\nvar _c;\n$RefreshReg$(_c, \"TimelineBuilder\");","map":{"version":3,"names":["React","useState","useEffect","Papa","AssetSelector","CampaignSetup","GanttChart","jsxDEV","_jsxDEV","TimelineBuilder","_s","csvData","setCsvData","uniqueAssets","setUniqueAssets","selectedAssets","setSelectedAssets","globalLiveDate","setGlobalLiveDate","useGlobalDate","setUseGlobalDate","assetLiveDates","setAssetLiveDates","calculatedStartDates","setCalculatedStartDates","projectStartDate","setProjectStartDate","dateErrors","setDateErrors","timelineTasks","setTimelineTasks","showInfoBox","setShowInfoBox","assetTaskDurations","setAssetTaskDurations","customTasks","setCustomTasks","customTaskNames","setCustomTaskNames","bankHolidays","setBankHolidays","history","setHistory","historyIndex","setHistoryIndex","isUndoRedoAction","setIsUndoRedoAction","getTaskName","taskId","assetName","taskInfo","createStateSnapshot","actionDescription","JSON","parse","stringify","timestamp","Date","now","actionType","restoreFromSnapshot","snapshot","undo","previousSnapshot","prev","redo","length","nextSnapshot","executeAction","actionFunction","currentSnapshot","newHistory","slice","Math","min","isNonWorkingDay","date","day","getDay","yyyy_mm_dd","toISOString","split","includes","getPreviousWorkingDay","workingDate","setDate","getDate","getNextWorkingDay","subtractWorkingDays","endDate","workingDaysToSubtract","currentDate","remainingDays","addWorkingDays","startDate","workingDaysToAdd","window","location","origin","download","header","skipEmptyLines","complete","results","parsedData","data","assetTypes","Set","map","row","filter","type","error","console","fetch","then","response","json","events","tenYearsFromNow","getFullYear","getMonth","holidayDates","event","dateStr","catch","err","today","setHours","newCalculatedStartDates","newDateErrors","allStartDates","allTasks","forEach","asset","assetTasks","liveDate","isNaN","getTime","currentEndDate","ganttTasks","taskIndex","goLiveTaskId","id","unshift","name","start","end","progress","i","customDurations","duration","undefined","parseInt","taskStartDate","taskEndDate","finalTaskEndDate","push","earliestDate","currentCustomTasks","task","isCustom","unifiedTimeline","sortedCustomTasks","sort","a","b","aIndex","findIndex","bIndex","customTask","insertIndex","insertAfterTaskId","afterTaskIndex","newTaskStartDate","previousTask","previousTaskEnd","newTaskEndDate","newTaskRemainingDays","newCustomTask","splice","finalTimeline","tasksByAsset","custom","assetId","goLiveTask","find","regularTasks","calculatedTasks","allTasksSequential","customTasksForAsset","ct","afterTask","orderedTasks","index","customTasksAfterThis","assetTimeline","finalDateErrors","startsWith","earliestTask","reduce","earliest","handleKeyDown","e","ctrlKey","metaKey","key","shiftKey","preventDefault","document","addEventListener","removeEventListener","newLiveDates","updated","generateTimelineTasks","startDates","Object","keys","generateAssetId","random","handleAddAsset","assetType","newAsset","handleRemoveAsset","assetToRemove","handleRenameAsset","newName","assetToRename","handleRenameTask","currentTask","handleAssetLiveDateChange","handleAssetStartDateChange","newDate","assetToUpdate","handleSaveTaskDurations","durations","handleTaskDurationChange","newDuration","newEndDate","taskName","currentDurations","handleAddCustomTask","customTaskData","newTaskId","afterTaskEnd","newTask","newTimelineTasks","countWorkingDays","count","current","calculateWorkingDaysBetween","workingDays","dayOfWeek","calculateTaskEndDate","calculateWorkingDaysNeeded","totalDaysInPast","calculatedStart","taskStart","available","allocated","needed","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","title","style","minWidth","onGlobalLiveDateChange","onUseGlobalDateChange","useGlobal","workingDaysNeeded","assets","onAddAsset","onRemoveAsset","onAssetLiveDateChange","onRenameAsset","onAssetStartDateChange","onSaveTaskDurations","maxWidth","tasks","onTaskDurationChange","onTaskNameChange","onAddCustomTask","_c","$RefreshReg$"],"sources":["/Users/hamishnicklin/Accordion3F/src/TimelineBuilder.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Papa from 'papaparse';\nimport AssetSelector from './components/AssetSelector';\nimport CampaignSetup from './components/CampaignSetup';\nimport GanttChart from './components/GanttChart';\n\nconst TimelineBuilder = () => {\n    // CSV and asset data\n    const [csvData, setCsvData] = useState([]);\n    const [uniqueAssets, setUniqueAssets] = useState([]);\n    // Each selected asset is now an object with a unique id, type, name, and startDate\n    const [selectedAssets, setSelectedAssets] = useState([]);\n    \n    // Live date management\n    const [globalLiveDate, setGlobalLiveDate] = useState('');\n    const [useGlobalDate, setUseGlobalDate] = useState(true);\n    const [assetLiveDates, setAssetLiveDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n    \n    // Calculated results\n    const [calculatedStartDates, setCalculatedStartDates] = useState({}); // {assetName: 'YYYY-MM-DD'}\n    const [projectStartDate, setProjectStartDate] = useState(''); // Earliest start date across all assets\n    const [dateErrors, setDateErrors] = useState([]); // Array of asset names that start before today\n    \n    // Final timeline for display\n    const [timelineTasks, setTimelineTasks] = useState([]);\n    const [showInfoBox, setShowInfoBox] = useState(true); // Add state for info box\n\n    // Add state to store custom task durations for each asset instance\n    const [assetTaskDurations, setAssetTaskDurations] = useState({}); // { assetId: { taskName: duration, ... } }\n\n    // Add state to store custom tasks separately\n    const [customTasks, setCustomTasks] = useState([]); // Array of custom task objects\n\n    // Add state to store custom task names\n    const [customTaskNames, setCustomTaskNames] = useState({}); // { taskId: customName }\n\n    // Add state to store bank holidays\n    const [bankHolidays, setBankHolidays] = useState([]); // Array of YYYY-MM-DD strings\n\n    // Undo/Redo infrastructure\n    const [history, setHistory] = useState([]);\n    const [historyIndex, setHistoryIndex] = useState(-1);\n    const [isUndoRedoAction, setIsUndoRedoAction] = useState(false);\n\n    // Helper function to get task name (custom or default)\n    const getTaskName = (taskId, assetName, taskInfo) => {\n        // Check if there's a custom name for this task\n        if (customTaskNames[taskId]) {\n            return customTaskNames[taskId];\n        }\n        // Return default format\n        return `${assetName}: ${taskInfo['Task']}`;\n    };\n\n    // Create a snapshot of the current app state for undo/redo\n    const createStateSnapshot = (actionDescription) => ({\n        // Asset state\n        selectedAssets: JSON.parse(JSON.stringify(selectedAssets)),\n        assetLiveDates: JSON.parse(JSON.stringify(assetLiveDates)),\n        useGlobalDate,\n        globalLiveDate,\n        \n        // Task state\n        customTaskNames: JSON.parse(JSON.stringify(customTaskNames)),\n        assetTaskDurations: JSON.parse(JSON.stringify(assetTaskDurations)),\n        customTasks: JSON.parse(JSON.stringify(customTasks)),\n        \n        // UI state\n        showInfoBox,\n        \n        // Calculated state (will be recalculated after restoration)\n        timelineTasks: JSON.parse(JSON.stringify(timelineTasks)),\n        calculatedStartDates: JSON.parse(JSON.stringify(calculatedStartDates)),\n        dateErrors: JSON.parse(JSON.stringify(dateErrors)),\n        projectStartDate,\n        \n        // Metadata\n        timestamp: Date.now(),\n        actionDescription,\n        actionType: 'user_action'\n    });\n\n    // Restore app state from a snapshot\n    const restoreFromSnapshot = (snapshot) => {\n        // Restore all state from snapshot\n        setSelectedAssets(snapshot.selectedAssets);\n        setAssetLiveDates(snapshot.assetLiveDates);\n        setUseGlobalDate(snapshot.useGlobalDate);\n        setGlobalLiveDate(snapshot.globalLiveDate);\n        setCustomTaskNames(snapshot.customTaskNames);\n        setAssetTaskDurations(snapshot.assetTaskDurations);\n        setCustomTasks(snapshot.customTasks);\n        setShowInfoBox(snapshot.showInfoBox);\n        \n        // Restore calculated state\n        setTimelineTasks(snapshot.timelineTasks);\n        setCalculatedStartDates(snapshot.calculatedStartDates);\n        setDateErrors(snapshot.dateErrors);\n        setProjectStartDate(snapshot.projectStartDate);\n    };\n\n    // Undo function\n    const undo = () => {\n        if (historyIndex > 0) {\n            setIsUndoRedoAction(true);\n            const previousSnapshot = history[historyIndex - 1];\n            restoreFromSnapshot(previousSnapshot);\n            setHistoryIndex(prev => prev - 1);\n            setIsUndoRedoAction(false);\n        }\n    };\n\n    // Redo function\n    const redo = () => {\n        if (historyIndex < history.length - 1) {\n            setIsUndoRedoAction(true);\n            const nextSnapshot = history[historyIndex + 1];\n            restoreFromSnapshot(nextSnapshot);\n            setHistoryIndex(prev => prev + 1);\n            setIsUndoRedoAction(false);\n        }\n    };\n\n    // Execute an action and save to history\n    const executeAction = (actionFunction, actionDescription) => {\n        // Save current state before action\n        const currentSnapshot = createStateSnapshot(actionDescription);\n        \n        // Execute the action\n        actionFunction();\n        \n        // Add to history (unless this is an undo/redo action)\n        if (!isUndoRedoAction) {\n            setHistory(prev => {\n                const newHistory = [...prev.slice(0, historyIndex + 1), currentSnapshot];\n                // Limit history to last 50 actions to prevent memory issues\n                return newHistory.slice(-50);\n            });\n            setHistoryIndex(prev => Math.min(prev + 1, 49));\n        }\n    };\n\n    // Helper function to check if date is a non-working day (weekend or bank holiday)\n    const isNonWorkingDay = (date) => {\n        const day = date.getDay();\n        const yyyy_mm_dd = date.toISOString().split('T')[0];\n        return day === 0 || day === 6 || bankHolidays.includes(yyyy_mm_dd);\n    };\n\n    // Helper function to get previous working day\n    const getPreviousWorkingDay = (date) => {\n        let workingDate = new Date(date);\n        do {\n            workingDate.setDate(workingDate.getDate() - 1);\n        } while (isNonWorkingDay(workingDate));\n        return workingDate;\n    };\n\n    // Helper function to get next working day\n    const getNextWorkingDay = (date) => {\n        let workingDate = new Date(date);\n        do {\n            workingDate.setDate(workingDate.getDate() + 1);\n        } while (isNonWorkingDay(workingDate));\n        return workingDate;\n    };\n\n    // Helper function to subtract working days (backwards calculation)\n    const subtractWorkingDays = (endDate, workingDaysToSubtract) => {\n        let currentDate = new Date(endDate);\n        let remainingDays = workingDaysToSubtract;\n        // Subtract working days\n        while (remainingDays > 0) {\n            currentDate.setDate(currentDate.getDate() - 1);\n            // Only count non-non-working days\n            if (!isNonWorkingDay(currentDate)) {\n                remainingDays--;\n            }\n        }\n        return currentDate;\n    };\n\n    // Helper function to add working days (forward calculation for display)\n    const addWorkingDays = (startDate, workingDaysToAdd) => {\n        if (workingDaysToAdd <= 0) {\n            return new Date(startDate);\n        }\n        let currentDate = new Date(startDate);\n        let remainingDays = workingDaysToAdd - 1;\n        while (remainingDays > 0) {\n            currentDate.setDate(currentDate.getDate() + 1);\n            if (!isNonWorkingDay(currentDate)) {\n                remainingDays--;\n            }\n        }\n        // Ensure the final day is a working day\n        while (isNonWorkingDay(currentDate)) {\n            currentDate.setDate(currentDate.getDate() + 1);\n        }\n        return currentDate;\n    };\n\n    // Load CSV data\n    useEffect(() => {\n        Papa.parse(`${window.location.origin}/Group_Asset_Task_Time.csv`, {\n            download: true,\n            header: true,\n            skipEmptyLines: true,\n            complete: (results) => {\n                const parsedData = results.data;\n                setCsvData(parsedData);\n                \n                // Extract unique asset types from CSV\n                const assetTypes = [...new Set(parsedData.map(row => row['Asset Type']))].filter(type => type);\n                setUniqueAssets(assetTypes);\n            },\n            error: (error) => {\n                console.error(\"Error parsing CSV file:\", error);\n            }\n        });\n    }, []);\n\n    // Fetch UK bank holidays for England and Wales on app load\n    useEffect(() => {\n        fetch('https://www.gov.uk/bank-holidays.json')\n            .then(response => response.json())\n            .then(data => {\n                // Get all dates for England and Wales\n                const events = data['england-and-wales'].events;\n                // Get all dates for the next 10 years\n                const now = new Date();\n                const tenYearsFromNow = new Date(now.getFullYear() + 10, now.getMonth(), now.getDate());\n                const holidayDates = events\n                    .map(event => event.date)\n                    .filter(dateStr => {\n                        const date = new Date(dateStr);\n                        return date >= now && date <= tenYearsFromNow;\n                    });\n                setBankHolidays(holidayDates);\n            })\n            .catch(err => {\n                // If fetch fails, fallback to an empty array (or you could use a static list)\n                setBankHolidays([]);\n            });\n    }, []);\n\n    // Calculate backwards timeline when live dates or assets change\n    useEffect(() => {\n        if (selectedAssets.length === 0 || csvData.length === 0) {\n            setTimelineTasks([]);\n            setCalculatedStartDates({});\n            setProjectStartDate('');\n            setDateErrors([]);\n            return;\n        }\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0); // Reset time for accurate comparison\n        \n        const newCalculatedStartDates = {};\n        const newDateErrors = [];\n        const allStartDates = [];\n        const allTasks = [];\n\n        // Loop over each selected asset instance (not just type)\n        selectedAssets.forEach(asset => {\n            // asset: { id, type, name, startDate }\n            if (!asset.startDate) return; // Skip if no start date set\n\n            // Find all tasks for this asset type from the CSV\n            const assetTasks = csvData.filter(row => row['Asset Type'] === asset.type);\n            if (assetTasks.length === 0) return;\n\n            // Use the asset instance's startDate as the go-live date\n            const liveDate = new Date(asset.startDate);\n            if (isNaN(liveDate.getTime())) return;\n\n            // We'll build the tasks in reverse (from go-live backwards)\n            let currentEndDate = new Date(liveDate);\n            const ganttTasks = [];\n            let taskIndex = 0;\n\n            // Go-live task (single day)\n            const goLiveTaskId = `${asset.id}-go-live`;\n            ganttTasks.unshift({\n                id: goLiveTaskId,\n                name: getTaskName(goLiveTaskId, asset.name, { 'Task': 'Go-Live' }),\n                start: liveDate.toISOString().split('T')[0],\n                end: liveDate.toISOString().split('T')[0],\n                progress: 0,\n            });\n            taskIndex++;\n\n            // Process all other tasks in reverse order\n            for (let i = assetTasks.length - 1; i >= 0; i--) {\n                const taskInfo = assetTasks[i];\n                // Use custom duration if present, else default from CSV\n                const customDurations = assetTaskDurations[asset.id] || {};\n                const duration = customDurations[taskInfo['Task']] !== undefined\n                    ? customDurations[taskInfo['Task']]\n                    : parseInt(taskInfo['Duration (Days)'], 10) || 1;\n                // Subtract working days to get the start date\n                const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                // Task ends the working day before currentEndDate\n                const taskEndDate = new Date(currentEndDate);\n                taskEndDate.setDate(taskEndDate.getDate() - 1);\n                // Ensure end date is a working day\n                let finalTaskEndDate = new Date(taskEndDate);\n                if (isNonWorkingDay(finalTaskEndDate)) {\n                    finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                }\n                const taskId = `${asset.id}-task-${taskIndex}`;\n                ganttTasks.unshift({\n                    id: taskId,\n                    name: getTaskName(taskId, asset.name, taskInfo),\n                    start: taskStartDate.toISOString().split('T')[0],\n                    end: finalTaskEndDate.toISOString().split('T')[0],\n                    progress: 0,\n                });\n                taskIndex++;\n                // Update currentEndDate for the next task\n                currentEndDate = new Date(taskStartDate);\n            }\n\n            // Add all tasks for this asset instance to the main list\n            allTasks.push(...ganttTasks);\n\n            // Set the calculated start date for this asset to the start date of the first (earliest) task\n            if (ganttTasks.length > 0 && ganttTasks[0].start) {\n                newCalculatedStartDates[asset.id] = ganttTasks[0].start;\n                allStartDates.push(new Date(ganttTasks[0].start));\n            }\n\n            // Check if start date is before today\n            if (ganttTasks.length > 0 && new Date(ganttTasks[0].start) < today) {\n                newDateErrors.push(asset.id);\n            }\n        });\n\n        // Find earliest start date across all assets\n        if (allStartDates.length > 0) {\n            const earliestDate = new Date(Math.min(...allStartDates));\n            setProjectStartDate(earliestDate.toISOString().split('T')[0]);\n        }\n\n        // Integrate custom tasks into the main timeline calculation\n        const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n        if (currentCustomTasks.length > 0) {\n            setCustomTasks(currentCustomTasks);\n            \n            // Create a unified timeline that includes both asset tasks and custom tasks\n            const unifiedTimeline = [...allTasks];\n            \n            // Sort custom tasks by their original insertion order\n            const sortedCustomTasks = [...currentCustomTasks].sort((a, b) => {\n                const aIndex = timelineTasks.findIndex(task => task.id === a.id);\n                const bIndex = timelineTasks.findIndex(task => task.id === b.id);\n                return aIndex - bIndex;\n            });\n            \n            // Insert custom tasks at their correct positions in the unified timeline\n            sortedCustomTasks.forEach(customTask => {\n                let insertIndex = 0;\n                if (customTask.insertAfterTaskId) {\n                    const afterTaskIndex = unifiedTimeline.findIndex(task => task.id === customTask.insertAfterTaskId);\n                    if (afterTaskIndex !== -1) {\n                        insertIndex = afterTaskIndex + 1;\n                    }\n                }\n                \n                // Calculate the custom task dates based on the current unified timeline\n                let newTaskStartDate;\n                if (insertIndex === 0) {\n                    // Insert at the beginning\n                    newTaskStartDate = new Date(projectStartDate);\n                } else {\n                    // Insert after another task\n                    const previousTask = unifiedTimeline[insertIndex - 1];\n                    const previousTaskEnd = new Date(previousTask.end);\n                    newTaskStartDate = new Date(previousTaskEnd);\n                    newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n                    \n                    // Ensure the start date is a working day\n                    while (isNonWorkingDay(newTaskStartDate)) {\n                        newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n                    }\n                }\n                \n                // Calculate the end date based on duration (inclusive)\n                let newTaskEndDate = new Date(newTaskStartDate);\n                let newTaskRemainingDays = customTask.duration - 1;\n                \n                while (newTaskRemainingDays > 0) {\n                    newTaskEndDate.setDate(newTaskEndDate.getDate() + 1);\n                    if (!isNonWorkingDay(newTaskEndDate)) {\n                        newTaskRemainingDays--;\n                    }\n                }\n                \n                // Create the custom task with recalculated dates\n                const newCustomTask = {\n                    ...customTask,\n                    id: customTask.id,\n                    name: customTask.name,\n                    duration: customTask.duration,\n                    start: newTaskStartDate.toISOString().split('T')[0],\n                    end: newTaskEndDate.toISOString().split('T')[0],\n                    isCustom: true\n                };\n                \n                // Insert the custom task into the unified timeline\n                unifiedTimeline.splice(insertIndex, 0, newCustomTask);\n            });\n            \n            // After inserting custom tasks, rebuild the timeline backwards from go-live\n            // This preserves the fixed go-live date and respects manual duration overrides\n            const finalTimeline = [];\n            \n            // Group tasks by asset to maintain the backwards calculation\n            const tasksByAsset = {};\n            unifiedTimeline.forEach(task => {\n                if (task.isCustom) {\n                    // Custom tasks will be inserted at their specified positions\n                    if (!tasksByAsset.custom) tasksByAsset.custom = [];\n                    tasksByAsset.custom.push(task);\n                } else {\n                    // Asset tasks are grouped by their asset ID\n                    const assetId = task.id.split('-')[0];\n                    if (!tasksByAsset[assetId]) tasksByAsset[assetId] = [];\n                    tasksByAsset[assetId].push(task);\n                }\n            });\n            \n            // Rebuild each asset's timeline backwards from go-live\n            selectedAssets.forEach(asset => {\n                const assetTasks = tasksByAsset[asset.id] || [];\n                if (assetTasks.length === 0) return;\n                \n                // Separate go-live task from other tasks\n                const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n                const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n                \n                // Build backwards from go-live to calculate dates\n                let currentEndDate = new Date(asset.startDate);\n                const calculatedTasks = [];\n                \n                // Calculate dates for regular tasks in reverse order (backwards from go-live)\n                for (let i = regularTasks.length - 1; i >= 0; i--) {\n                    const task = regularTasks[i];\n                    const taskInfo = csvData.find(row => \n                        row['Asset Type'] === asset.type && \n                        row['Task'] === task.name.split(': ')[1]\n                    );\n                    \n                    // Use manual duration override if available\n                    const customDurations = assetTaskDurations[asset.id] || {};\n                    const duration = customDurations[taskInfo?.['Task']] !== undefined\n                        ? customDurations[taskInfo['Task']]\n                        : parseInt(taskInfo?.['Duration (Days)'], 10) || 1;\n                    \n                    const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                    const taskEndDate = new Date(currentEndDate);\n                    taskEndDate.setDate(taskEndDate.getDate() - 1);\n                    \n                    // Ensure end date is a working day\n                    let finalTaskEndDate = new Date(taskEndDate);\n                    if (isNonWorkingDay(finalTaskEndDate)) {\n                        finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                    }\n                    \n                    calculatedTasks.unshift({\n                        ...task,\n                        start: taskStartDate.toISOString().split('T')[0],\n                        end: finalTaskEndDate.toISOString().split('T')[0]\n                    });\n                    \n                    currentEndDate = new Date(taskStartDate);\n                }\n                \n                // Add go-live task at the end\n                if (goLiveTask) {\n                    calculatedTasks.push({\n                        ...goLiveTask,\n                        start: asset.startDate,\n                        end: asset.startDate\n                    });\n                }\n                \n                // Add all tasks to final timeline in correct order\n                finalTimeline.push(...calculatedTasks);\n            });\n            \n            // Now rebuild the entire timeline sequentially including custom tasks\n            const allTasksSequential = [];\n            \n            // First, collect all tasks (asset tasks + custom tasks) in the correct order\n            selectedAssets.forEach(asset => {\n                const assetTasks = tasksByAsset[asset.id] || [];\n                const customTasksForAsset = customTasks.filter(ct => {\n                    // Find which asset this custom task belongs to based on insertAfterTaskId\n                    if (ct.insertAfterTaskId) {\n                        const afterTask = assetTasks.find(task => task.id === ct.insertAfterTaskId);\n                        return afterTask !== undefined;\n                    }\n                    return false;\n                });\n                \n                // Separate go-live task from regular tasks\n                const goLiveTask = assetTasks.find(task => task.name.includes('Go-Live'));\n                const regularTasks = assetTasks.filter(task => !task.name.includes('Go-Live'));\n                \n                // Create ordered task list for this asset\n                const orderedTasks = [];\n                \n                // Add regular tasks in their original order\n                regularTasks.forEach((task, index) => {\n                    orderedTasks.push(task);\n                    \n                    // Insert custom tasks that should go after this task\n                    const customTasksAfterThis = customTasksForAsset.filter(ct => \n                        ct.insertAfterTaskId === task.id\n                    );\n                    orderedTasks.push(...customTasksAfterThis);\n                });\n                \n                // Add go-live task at the end\n                if (goLiveTask) {\n                    orderedTasks.push(goLiveTask);\n                }\n                \n                // Now build the timeline backwards from go-live for this asset\n                let currentEndDate = new Date(asset.startDate);\n                const assetTimeline = [];\n                \n                // Process tasks in reverse order (backwards from go-live)\n                for (let i = orderedTasks.length - 1; i >= 0; i--) {\n                    const task = orderedTasks[i];\n                    \n                    if (task.isCustom) {\n                        // Custom task - calculate backwards\n                        const taskStartDate = subtractWorkingDays(currentEndDate, task.duration);\n                        const taskEndDate = new Date(currentEndDate);\n                        taskEndDate.setDate(taskEndDate.getDate() - 1);\n                        \n                        // Ensure end date is a working day\n                        let finalTaskEndDate = new Date(taskEndDate);\n                        if (isNonWorkingDay(finalTaskEndDate)) {\n                            finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                        }\n                        \n                        assetTimeline.unshift({\n                            ...task,\n                            start: taskStartDate.toISOString().split('T')[0],\n                            end: finalTaskEndDate.toISOString().split('T')[0]\n                        });\n                        \n                        currentEndDate = new Date(taskStartDate);\n                    } else if (task.name.includes('Go-Live')) {\n                        // Go-live task\n                        assetTimeline.unshift({\n                            ...task,\n                            start: currentEndDate.toISOString().split('T')[0],\n                            end: currentEndDate.toISOString().split('T')[0]\n                        });\n                    } else {\n                        // Regular asset task - calculate backwards\n                        const taskInfo = csvData.find(row => \n                            row['Asset Type'] === asset.type && \n                            row['Task'] === task.name.split(': ')[1]\n                        );\n                        \n                        // Use manual duration override if available\n                        const customDurations = assetTaskDurations[asset.id] || {};\n                        const duration = customDurations[taskInfo?.['Task']] !== undefined\n                            ? customDurations[taskInfo['Task']]\n                            : parseInt(taskInfo?.['Duration (Days)'], 10) || 1;\n                        \n                        const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                        const taskEndDate = new Date(currentEndDate);\n                        taskEndDate.setDate(taskEndDate.getDate() - 1);\n                        \n                        // Ensure end date is a working day\n                        let finalTaskEndDate = new Date(taskEndDate);\n                        if (isNonWorkingDay(finalTaskEndDate)) {\n                            finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                        }\n                        \n                        assetTimeline.unshift({\n                            ...task,\n                            start: taskStartDate.toISOString().split('T')[0],\n                            end: finalTaskEndDate.toISOString().split('T')[0]\n                        });\n                        \n                        currentEndDate = new Date(taskStartDate);\n                    }\n                }\n                \n                // Add this asset's timeline to the main timeline\n                allTasksSequential.push(...assetTimeline);\n            });\n            \n            // Update the final timeline\n            finalTimeline.length = 0;\n            finalTimeline.push(...allTasksSequential);\n            \n            setTimelineTasks(finalTimeline);\n            \n            // Recalculate dateErrors based on the final timeline\n            const finalDateErrors = [];\n            const today = new Date();\n            today.setHours(0, 0, 0, 0);\n            \n            selectedAssets.forEach(asset => {\n                const assetTasks = finalTimeline.filter(task => \n                    task.id.startsWith(`${asset.id}-`) && !task.name.includes('Go-Live')\n                );\n                \n                if (assetTasks.length > 0) {\n                    // Find the earliest task for this asset\n                    const earliestTask = assetTasks.reduce((earliest, task) => {\n                        return new Date(task.start) < new Date(earliest.start) ? task : earliest;\n                    });\n                    \n                    // Update calculated start date\n                    newCalculatedStartDates[asset.id] = earliestTask.start;\n                    \n                    // Check if start date is before today\n                    if (new Date(earliestTask.start) < today) {\n                        finalDateErrors.push(asset.id);\n                    }\n                }\n            });\n            \n            setCalculatedStartDates(newCalculatedStartDates);\n            setDateErrors(finalDateErrors);\n        } else {\n            setTimelineTasks(allTasks);\n            setCalculatedStartDates(newCalculatedStartDates);\n            setDateErrors(newDateErrors);\n        }\n    }, [selectedAssets, globalLiveDate, useGlobalDate, assetLiveDates, csvData, assetTaskDurations, customTaskNames]);\n\n    // Keyboard shortcuts for undo/redo\n    useEffect(() => {\n        const handleKeyDown = (e) => {\n            if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                undo();\n            }\n            if (((e.ctrlKey || e.metaKey) && e.key === 'y') || \n                ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'z')) {\n                e.preventDefault();\n                redo();\n            }\n        };\n        \n        document.addEventListener('keydown', handleKeyDown);\n        return () => document.removeEventListener('keydown', handleKeyDown);\n    }, [historyIndex, history.length]);\n// This new useEffect pre-populates individual dates when switching from global mode\n    useEffect(() => {\n        if (!useGlobalDate && globalLiveDate && selectedAssets.length > 0) {\n            const newLiveDates = { ...assetLiveDates };\n            let updated = false;\n            selectedAssets.forEach(asset => {\n                // Pre-fill only if the asset doesn't have an individual date set\n                if (!newLiveDates[asset.name]) { // Changed to asset.name\n                    newLiveDates[asset.name] = globalLiveDate; // Changed to asset.name\n                    updated = true;\n                }\n            });\n            if (updated) {\n                setAssetLiveDates(newLiveDates);\n            }\n        }\n    }, [useGlobalDate, globalLiveDate, selectedAssets, assetLiveDates]);\n\n    // Sync all asset instance startDates to globalLiveDate if useGlobalDate is true\nuseEffect(() => {\n    if (useGlobalDate && globalLiveDate && !isUndoRedoAction) {\n        setSelectedAssets(prev =>\n            prev.map(asset =>\n                asset.startDate !== globalLiveDate\n                    ? { ...asset, startDate: globalLiveDate }\n                    : asset\n            )\n        );\n    }\n    // Optionally, if unchecked, you could clear the dates or leave as-is\n}, [useGlobalDate, globalLiveDate]);\n\n    // Preserve custom tasks whenever timelineTasks changes\n    useEffect(() => {\n        const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n        if (currentCustomTasks.length > 0) {\n            setCustomTasks(currentCustomTasks);\n        }\n    }, [timelineTasks]);\n\n    // REMOVED: Separate custom task merging useEffect\n    // Custom tasks are now integrated directly into the main timeline calculation\n\n    // REMOVED: Custom task merging useEffect that was causing timeline disruption\n    // Custom tasks are now handled properly in the main timeline calculation\n    // Generate timeline tasks for Gantt chart\n    const generateTimelineTasks = (startDates) => {\n        if (selectedAssets.length === 0 || Object.keys(startDates).length === 0) {\n            setTimelineTasks([]);\n            return;\n        }\n\n        const allTasks = [];\n        let taskIndex = 0;\n\n        selectedAssets.forEach(asset => {\n            const assetName = asset.name; // Assuming asset object has a 'name' property\n            const assetTasks = csvData.filter(row => row['Asset Type'] === assetName);\n            if (assetTasks.length === 0) return;\n\n            // Get the correct live date for this asset\n            const liveDate = new Date(useGlobalDate ? globalLiveDate : assetLiveDates[assetName]);\n            if (isNaN(liveDate.getTime())) return;\n\n            // We'll build the tasks in reverse (from go-live backwards)\n            let currentEndDate = new Date(liveDate);\n            const ganttTasks = [];\n            let taskIndex = 0;\n\n            // Go-live task (single day)\n            ganttTasks.unshift({\n                id: `task-${taskIndex}`,\n                name: `${assetName}: Go-Live`,\n                start: liveDate.toISOString().split('T')[0],\n                end: liveDate.toISOString().split('T')[0],\n                progress: 0,\n            });\n            taskIndex++;\n\n            // Process all other tasks in reverse order\n            for (let i = assetTasks.length - 1; i >= 0; i--) {\n                const taskInfo = assetTasks[i];\n                const duration = parseInt(taskInfo['Duration (Days)'], 10) || 1;\n                // Subtract working days to get the start date\n                const taskStartDate = subtractWorkingDays(currentEndDate, duration);\n                // Task ends the working day before currentEndDate\n                const taskEndDate = new Date(currentEndDate);\n                taskEndDate.setDate(taskEndDate.getDate() - 1);\n                // Ensure end date is a working day\n                let finalTaskEndDate = new Date(taskEndDate);\n                if (isNonWorkingDay(finalTaskEndDate)) {\n                    finalTaskEndDate = getPreviousWorkingDay(finalTaskEndDate);\n                }\n                ganttTasks.unshift({\n                    id: `task-${taskIndex}`,\n                    name: `${taskInfo['Asset Type']}: ${taskInfo['Task']}`,\n                    start: taskStartDate.toISOString().split('T')[0],\n                    end: finalTaskEndDate.toISOString().split('T')[0],\n                    progress: 0,\n                });\n                taskIndex++;\n                // Update currentEndDate for the next task\n                currentEndDate = new Date(taskStartDate);\n            }\n\n            // Add all tasks for this asset to the main list\n            allTasks.push(...ganttTasks);\n\n            // Set the calculated start date for this asset to the start date of the first (earliest) task\n            if (ganttTasks.length > 0 && ganttTasks[0].start) {\n                newCalculatedStartDates[assetName] = ganttTasks[0].start;\n            }\n        });\n        \n        // Merge custom tasks back into the timeline\n        if (customTasks.length > 0) {\n            // Insert custom tasks at their specified positions\n            customTasks.forEach(customTask => {\n                let insertIndex = 0;\n                if (customTask.insertAfterTaskId) {\n                    const afterTaskIndex = allTasks.findIndex(task => task.id === customTask.insertAfterTaskId);\n                    if (afterTaskIndex !== -1) {\n                        insertIndex = afterTaskIndex + 1;\n                    }\n                }\n                \n                // Create a new custom task with updated dates\n                const newCustomTask = {\n                    ...customTask,\n                    id: customTask.id, // Keep the same ID\n                    name: customTask.name,\n                    duration: customTask.duration,\n                    isCustom: true\n                };\n                \n                // Insert the custom task\n                allTasks.splice(insertIndex, 0, newCustomTask);\n            });\n            \n            // Recalculate all task dates to accommodate custom tasks\n            // This is a simplified version - in practice, you'd want to recalculate dates\n            // based on the new timeline structure\n        }\n        \n        setCalculatedStartDates(newCalculatedStartDates);\n        setTimelineTasks(allTasks);\n    };\n\n    // Helper to generate a unique id (could use a counter or Date.now())\n    const generateAssetId = () => Date.now() + Math.random();\n\n    // Add a new asset instance\n    const handleAddAsset = (assetType) => {\n        executeAction(() => {\n            const newAsset = {\n                id: generateAssetId(),\n                type: assetType,\n                name: assetType, // default name, can be edited later\n                startDate: useGlobalDate && globalLiveDate ? globalLiveDate : ''\n            };\n            setSelectedAssets(prev => [...prev, newAsset]);\n        }, `Add ${assetType} asset`);\n    };\n\n    // Remove an asset instance by id\n    const handleRemoveAsset = (assetId) => {\n        const assetToRemove = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev => prev.filter(asset => asset.id !== assetId));\n        }, `Remove ${assetToRemove?.name || 'asset'}`);\n    };\n\n    // Handler to rename an asset instance by id\n    const handleRenameAsset = (assetId, newName) => {\n        const assetToRename = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev =>\n                prev.map(asset =>\n                    asset.id === assetId ? { ...asset, name: newName } : asset\n                )\n            );\n        }, `Rename asset to \"${newName}\"`);\n    };\n\n    // Handler to rename a task\n    const handleRenameTask = (taskId, newName) => {\n        const currentTask = timelineTasks.find(task => task.id === taskId);\n        executeAction(() => {\n            setCustomTaskNames(prev => ({\n                ...prev,\n                [taskId]: newName\n            }));\n        }, `Rename task to \"${newName}\"`);\n    };\n\n    const handleAssetLiveDateChange = (assetName, date) => {\n        executeAction(() => {\n            setAssetLiveDates(prev => ({\n                ...prev,\n                [assetName]: date\n            }));\n        }, `Change ${assetName} go-live date to ${date}`);\n    };\n\n    const handleAssetStartDateChange = (assetId, newDate) => {\n        const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setSelectedAssets(prev =>\n                prev.map(asset =>\n                    asset.id === assetId ? { ...asset, startDate: newDate } : asset\n                )\n            );\n        }, `Change ${assetToUpdate?.name || 'asset'} go-live date to ${newDate}`);\n    };\n\n    // Handler to save custom task durations for an asset\n    const handleSaveTaskDurations = (assetId, durations) => {\n        const assetToUpdate = selectedAssets.find(asset => asset.id === assetId);\n        executeAction(() => {\n            setAssetTaskDurations(prev => ({ ...prev, [assetId]: durations }));\n            \n            // Preserve custom tasks before timeline recalculation\n            const currentCustomTasks = timelineTasks.filter(task => task.isCustom);\n            setCustomTasks(currentCustomTasks);\n        }, `Update task durations for ${assetToUpdate?.name || 'asset'}`);\n    };\n\n    // Handler for drag-to-resize task duration\n    const handleTaskDurationChange = (taskId, newDuration, newEndDate) => {\n        // Find the task being modified\n        const taskIndex = timelineTasks.findIndex(task => task.id === taskId);\n        if (taskIndex === -1) return;\n\n        // Extract asset ID and task name from the task ID\n        const assetId = taskId.split('-task-')[0];\n        const taskName = timelineTasks[taskIndex].name.split(': ')[1]; // Get task name after the colon\n        \n        executeAction(() => {\n            // Update the assetTaskDurations state to trigger the same recalculation logic\n            // that the manual duration editing uses\n            setAssetTaskDurations(prev => {\n                const currentDurations = prev[assetId] || {};\n                return {\n                    ...prev,\n                    [assetId]: {\n                        ...currentDurations,\n                        [taskName]: newDuration\n                    }\n                };\n            });\n        }, `Change ${taskName} duration to ${newDuration} days`);\n    };\n\n    // Handler for adding custom tasks\n    const handleAddCustomTask = (customTaskData) => {\n        const { name, duration, insertAfterTaskId } = customTaskData;\n        \n        executeAction(() => {\n            // Create the new custom task with calculated dates\n            const newTaskId = `custom-task-${Date.now()}`;\n            \n            // Calculate start and end dates for the custom task\n            let newTaskStartDate;\n            if (insertAfterTaskId) {\n                // Insert after a specific task\n                const afterTask = timelineTasks.find(task => task.id === insertAfterTaskId);\n                if (afterTask) {\n                    const afterTaskEnd = new Date(afterTask.end);\n                    newTaskStartDate = new Date(afterTaskEnd);\n                    newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n                    \n                    // Ensure the start date is a working day\n                    while (isNonWorkingDay(newTaskStartDate)) {\n                        newTaskStartDate.setDate(newTaskStartDate.getDate() + 1);\n                    }\n                } else {\n                    // Fallback to project start date\n                    newTaskStartDate = new Date(projectStartDate);\n                }\n            } else {\n                // Insert at the beginning\n                newTaskStartDate = new Date(projectStartDate);\n            }\n            \n            // Calculate end date based on duration\n            let newTaskEndDate = new Date(newTaskStartDate);\n            let remainingDays = duration - 1; // -1 because we count the start date\n            \n            while (remainingDays > 0) {\n                newTaskEndDate.setDate(newTaskEndDate.getDate() + 1);\n                if (!isNonWorkingDay(newTaskEndDate)) {\n                    remainingDays--;\n                }\n            }\n            \n            const newTask = {\n                id: newTaskId,\n                name: `Custom: ${name}`,\n                start: newTaskStartDate.toISOString().split('T')[0],\n                end: newTaskEndDate.toISOString().split('T')[0],\n                duration: duration,\n                insertAfterTaskId: insertAfterTaskId,\n                isCustom: true,\n                progress: 0\n            };\n            \n            // Add to custom tasks\n            setCustomTasks(prev => [...prev, newTask]);\n            \n            // Insert the custom task at the correct position in timeline tasks\n            setTimelineTasks(prev => {\n                const newTimelineTasks = [...prev];\n                let insertIndex = 0;\n                \n                if (insertAfterTaskId) {\n                    // Find the position after the specified task\n                    const afterTaskIndex = newTimelineTasks.findIndex(task => task.id === insertAfterTaskId);\n                    if (afterTaskIndex !== -1) {\n                        insertIndex = afterTaskIndex + 1;\n                    }\n                }\n                \n                // Insert the custom task at the calculated position\n                newTimelineTasks.splice(insertIndex, 0, newTask);\n                return newTimelineTasks;\n            });\n        }, `Add custom task \"${name}\"`);\n    };\n\n        // Helper function to count working days between two dates (exclusive)\n    const countWorkingDays = (startDate, endDate) => {\n        let count = 0;\n        const current = new Date(startDate);\n        const end = new Date(endDate);\n\n        // Move to next day to make it exclusive\n        current.setDate(current.getDate() + 1);\n\n        while (current <= end) {\n            if (!isNonWorkingDay(current)) {\n                count++;\n            }\n            current.setDate(current.getDate() + 1);\n        }\n        return count;\n    };\n\n    // Single source of truth for working days calculation (same as AssetSelector)\n    const calculateWorkingDaysBetween = (startDate, endDate) => {\n        if (!startDate || !endDate) return 0;\n       \n        const start = new Date(startDate);\n        const end = new Date(endDate);\n       \n        if (start >= end) return 0;\n       \n        let workingDays = 0;\n        let currentDate = new Date(start);\n       \n        while (currentDate < end) {\n            const dayOfWeek = currentDate.getDay();\n            // Count if not weekend (0 = Sunday, 6 = Saturday)\n            if (dayOfWeek !== 0 && dayOfWeek !== 6) {\n                workingDays++;\n            }\n            currentDate.setDate(currentDate.getDate() + 1);\n        }\n       \n        return workingDays;\n    };\n\n    // Helper function to calculate task end date based on start date and duration\n    const calculateTaskEndDate = (startDate, duration) => {\n        let endDate = new Date(startDate);\n        let remainingDays = duration - 1; // -1 because we count the start date\n        \n        while (remainingDays > 0) {\n            endDate.setDate(endDate.getDate() + 1);\n            if (!isNonWorkingDay(endDate)) {\n                remainingDays--;\n            }\n        }\n        \n        return endDate.toISOString().split('T')[0];\n    };\n\n    // Single source of truth for working days needed (same as AssetSelector's getWorkingDaysToSave)\n    const calculateWorkingDaysNeeded = () => {\n        if (!globalLiveDate || timelineTasks.length === 0) return null;\n\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        \n        // Use the exact same logic as AssetSelector's getWorkingDaysToSave\n        let totalDaysInPast = 0;\n        \n        // Only count assets that are in dateErrors (same as asset-specific calculation)\n        selectedAssets.forEach(asset => {\n            const calculatedStart = calculatedStartDates[asset.id];\n            if (calculatedStart && dateErrors.includes(asset.id)) {\n                const startDate = new Date(calculatedStart);\n                totalDaysInPast += calculateWorkingDaysBetween(startDate, today);\n            }\n        });\n        \n        // Also check custom tasks that start in the past\n        timelineTasks.forEach(task => {\n            if (task.isCustom) {\n                const taskStart = new Date(task.start);\n                if (taskStart < today) {\n                    totalDaysInPast += calculateWorkingDaysBetween(taskStart, today);\n                }\n            }\n        });\n        \n        return {\n            available: 0, // Not used in this calculation\n            allocated: 0, // Not used in this calculation\n            needed: totalDaysInPast\n        };\n    };\n\n    return (\n        <div className=\"bg-gray-100 min-h-screen font-sans\">\n            <header className=\"bg-white shadow-md\">\n                <div className=\"container mx-auto px-6 py-4\">\n                    <div className=\"flex items-center justify-between\">\n                        <h1 className=\"text-3xl font-bold text-gray-800\">Accordion Timeline Builder</h1>\n                        <div className=\"flex items-center space-x-2\">\n                            <button\n                                onClick={undo}\n                                disabled={historyIndex <= 0}\n                                className=\"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n                                title=\"Undo (Ctrl+Z)\"\n                            >\n                                ↩️ Undo\n                            </button>\n                            <button\n                                onClick={redo}\n                                disabled={historyIndex >= history.length - 1}\n                                className=\"px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center\"\n                                title=\"Redo (Ctrl+Y)\"\n                            >\n                                ↪️ Redo\n                            </button>\n                        </div>\n                    </div>\n                    {/* Info Box: How to Use This Timeline Builder (moved here, dismissible) */}\n                    {showInfoBox && (\n                        <div className=\"relative mb-6 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-900\">\n                            <button\n                                className=\"absolute top-2 right-2 text-blue-700 hover:text-blue-900 text-lg font-bold focus:outline-none\"\n                                onClick={() => {\n                                    executeAction(() => setShowInfoBox(false), \"Hide instructions\");\n                                }}\n                                aria-label=\"Close instructions\"\n                            >\n                                ×\n                            </button>\n                            <strong>How to Build Your Campaign Timeline:</strong>\n                            <ol className=\"list-decimal pl-5 mt-2 space-y-1\">\n                                <li>\n                                    <strong>Choose Your Campaign Start Date:</strong><br />\n                                    If all assets launch on the same day, set a global start date and check “Use same live date for all assets.”<br />\n                                    If assets launch on different days, uncheck the box and set dates individually for each asset.\n                                </li>\n                                <li>\n                                    <strong>Add Assets:</strong><br />\n                                    Click “Add” next to each asset type you need.<br />\n                                    Need the same asset type more than once? Click “Add” again and give each a unique name.\n                                </li>\n                                <li>\n                                    <strong>Customize Assets:</strong><br />\n                                    Rename each asset for clarity (e.g., “Metro Advertorial – August”).<br />\n                                    Set or confirm the start date for each asset.\n                                </li>\n                                <li>\n                                    <strong>Review Your Timeline:</strong><br />\n                                    Remove any asset you don’t need.<br />\n                                    Check the timeline to ensure all assets are scheduled as planned.\n                                </li>\n                                <li>\n                                    <strong>Adjust Your Timeline if Needed:</strong><br />\n                                    If an asset’s timeline can’t be completed by the selected start date, you’ll see a warning.<br />\n                                    – You can either change the go-live date, or<br />\n                                    – Manually shorten the durations of individual tasks (“accordion” your timeline) until the schedule fits.\n                                </li>\n                                <li>\n                                    <strong>Undo/Redo:</strong><br />\n                                    Use Ctrl+Z to undo and Ctrl+Y to redo any changes you make.<br />\n                                    You can also use the Undo/Redo buttons in the top-right corner.\n                                </li>\n                            </ol>\n                        </div>\n                    )}\n                </div>\n            </header>\n            <main className=\"container mx-auto p-6\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                    {/* LEFT COLUMN: CONTROLS */}\n                    <div\n  className=\"lg:col-span-1 bg-white p-6 rounded-xl shadow-lg overflow-x-auto\"\n  style={{ minWidth: 380 }} // You can adjust 380 to your needs\n>\n                        <h2 className=\"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\">Timeline Setup</h2>\n                        <CampaignSetup \n                            globalLiveDate={globalLiveDate}\n                            onGlobalLiveDateChange={(date) => {\n                                executeAction(() => setGlobalLiveDate(date), `Change global go-live date to ${date}`);\n                            }}\n                            useGlobalDate={useGlobalDate}\n                            onUseGlobalDateChange={(useGlobal) => {\n                                executeAction(() => setUseGlobalDate(useGlobal), `Switch to ${useGlobal ? 'global' : 'individual'} date mode`);\n                            }}\n                            projectStartDate={projectStartDate}\n                            dateErrors={dateErrors}\n                            workingDaysNeeded={calculateWorkingDaysNeeded()}\n                        />\n<AssetSelector\n    assets={uniqueAssets || []}\n    selectedAssets={selectedAssets || []}\n    onAddAsset={handleAddAsset}\n    onRemoveAsset={handleRemoveAsset}\n    useGlobalDate={useGlobalDate}\n    globalLiveDate={globalLiveDate || ''}\n    assetLiveDates={assetLiveDates || {}}\n    onAssetLiveDateChange={handleAssetLiveDateChange}\n    calculatedStartDates={calculatedStartDates || {}}\n    dateErrors={dateErrors || []}\n    onRenameAsset={handleRenameAsset}\n    onAssetStartDateChange={handleAssetStartDateChange}\n    csvData={csvData}\n    onSaveTaskDurations={handleSaveTaskDurations}\n    isNonWorkingDay={isNonWorkingDay}\n    calculateWorkingDaysBetween={calculateWorkingDaysBetween}\n/>\n                    </div>\n                    \n                    {/* RIGHT COLUMN: TIMELINE */}\n                    <div\n  className=\"lg:col-span-2 bg-white p-6 rounded-xl shadow-lg\"\n  style={{ minWidth: 0, maxWidth: \"100%\" }}\n>\n                        <h2 className=\"text-xl font-semibold mb-4 border-b pb-3 text-gray-700\">Generated Timeline</h2>\n                        \n                     {/* Error Messages - Temporarily Disabled */}\n{/* {dateErrors.length > 0 && (\n    <div className=\"mb-4 p-4 bg-red-50 border border-red-200 rounded-md\">\n        <h3 className=\"text-red-800 font-medium mb-2\">⚠️ Timeline Conflicts</h3>\n        <p className=\"text-red-700 text-sm mb-2\">\n            The following assets cannot be completed by their live dates:\n        </p>\n        <ul className=\"text-red-700 text-sm\">\n            {dateErrors.map(asset => (\n                <li key={asset} className=\"ml-4\">\n                    • {asset} (would need to start on {calculatedStartDates[asset]})\n                </li>\n            ))}\n        </ul>\n        <p className=\"text-red-700 text-sm mt-2 font-medium\">\n            Manual adjustment of task durations required.\n        </p>\n    </div>\n)} */}\n\n                        {timelineTasks && timelineTasks.length > 0 ? (\n                            <GanttChart \n                                tasks={timelineTasks} \n                                bankHolidays={bankHolidays}\n                                onTaskDurationChange={handleTaskDurationChange}\n                                onTaskNameChange={handleRenameTask}\n                                workingDaysNeeded={calculateWorkingDaysNeeded()}\n                                onAddCustomTask={handleAddCustomTask}\n                            />\n                        ) : (\n                            <div className=\"text-center text-gray-500 py-10\">\n                                <p className=\"text-lg\">Your timeline will appear here.</p>\n                                <p className=\"text-sm\">Set a live date and select some assets to begin.</p>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </main>\n        </div>\n    );\n};\n\nexport default TimelineBuilder;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}